Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/g,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.convertEngLine().replaces(configs.rEnd).__endFixed().replace(/\n\n\n+/gm,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__endFixed:function(){var a=configs.rEndFixed;return this.replace(a.Latitude,function(b){return b.replace(/ /g,"").replaceAt(configs.halfPuns)}).replace(("\\b\\d+\\b *["+a.Number[0]+"] *\\b\\d+\\b(?: *["+a.Number[0]+"] *\\b\\d+\\b)?").getReg("g"),
function(b){return b.replace(/ /g,"").replaceAt(a.Number)}).replace(a.Time,function(b){return b.replace(/\uff1a/g,":").replace(/\uff0c/g,",")}).replace(a.Date,function(b){return b.replace(/\uff1a/g,":").replace(/\u65e5 */g,"\u65e5 ")}).replace(/^[\u300d\u300f\u201d\u2019]/gm,function(b){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(b))}).replace(/[\u300c\u300e\u201c\u2018](?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,function(b){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(b.charAt(0)))+
b.substring(1)})},replaceSpace:function(){return this.cleanSpace(configs.hanSpace)},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@@{3,}/g,configs.Separator)},replaceQuotes:function(a){var b=this.replaces(configs.rQuotes);return"cn"===a?b.replaceAt(configs.cnQuotes):b},__convertEnglish:function(){return this.replaceAt(configs.halfPuns).replaces(configs.halfSymbol).matchLower(configs.findEng.PunAfter).matchUpper(/[\.\?!:&] ?[a-z]/g).trim()},convertEngLine:function(){var a=
configs.findEng;return this.replace(a.Line,function(b){return/^[\u201c\u300c][a-z]{1,6}(?:\u3002|[\uff01\uff1f]{1,3}|\u2026\u2026|\u2014\u2014)[\u300d\u201d]$/mi.test(b)||2>b.findCount(a.LineSkip)||!b.sr(/[,\uff0c ]/)?b:b.replaceAt(configs.halfPunsOther).__convertEnglish()})},convertEnglish:function(){var a=configs.findEng,b=a.Word,g;return this.matchLower(/[A-Z]/g).matchFirstUpper().replace(a.Sep,function(d){return d.matchLower(/[A-Z]/g).matchUpper(/^[a-z]/).matchLower(/ [A-Z]/g).replace("[{$enSep}]+".comReg("g"),
"'")}).replace(a.Bracket,function(d){return-1<d.indexOf(" ")?d:d.toUpperCase()}).replace(configs.findEng.PunFix,function(d){return-1<d.indexOf("'")?d.matchLower(/ [A-Z]/g):d}).replace(/\b[\w\-~\uff5e]+\b/g,function(d){return d.sr(/\d/)?d.toUpperCase():d}).replace(a.HonorWord,function(d){return d.matchFirstUpper().replace(/\u3002/g,".")}).matchUpper(("\\b(?:"+a.WordUpper+")\\b").getReg("gi")).replace(("\\b("+b+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(d,f,k){g=("|"+b.toLowerCase()+
"|").indexOf("|"+f.toLowerCase()+"|")+1;return("|"+b+"|").substr(g,f.length)+k.toUpperCase()}).matchUpper(a.Continuous).replace(a.LowerExt,function(d){return d.toLowerCase().replace(/\u3002/g,".")}).replace(a.Site,function(d){return d.toLowerCase().replaceAt(a.SiteFix)}).replaces(a.WordFix).matchUpper(/ \b[a-z]\b /g)},convertNumberLetter:function(a){a=configs.sNumberLetter;return this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,"$1 ").replaceAt(a)},__chapterFullNumber:function(){return this.replace(configs.regFullNumberTitle,
function(a){return a.replaceAt(configs.sNumber)})},convertFullNumberLetter:function(){return this.replaceAt(configs.sNumberLetter,!0).__chapterFullNumber()},convertUnicode:function(){return this.replace(/(?:[\uff06&]#x|\\u?)[\da-f]{4}[;\uff1b]?/gi,function(a){return unescape(a.replace(/[\uff06&]#x|\\u?/gi,"%u").replace(/[;\uff1b]/g,""))}).replace(/[\uff06&]#\d+[;\uff1b]/g,function(a,b){return String.fromCharCode(b)}).replace(/(?:[%\uff05][\da-f]{2})+/gi,function(a){try{return decodeURIComponent(a.replace(/\uff05/g,
"%"))}catch(b){}return a})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,function(a,b){return configs.sHtmlEntity[b]||configs.sHtmlEntity[b.toLowerCase()]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){var a=configs.sSerialNumber,b=a[1].split("|");return this.replace(("["+a[0]+"]").getReg(),function(g){return"\uff08{$zz}\uff09".fmt(b[a[0].indexOf(g)]||"")})},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.punSymbolFix).replaces(configs.nwSymbol)},
setAlign:function(a,b,g){var d=2*configs.Linenum,f=this.trims(),k=f.len();checkNull(a)&&(a="");checkNull(b)&&(b="");"center"===g?(g=0===k%4?" ":"",d>k&&(f="\u3000".times(~~((d-k)/4))+g+f)):"right"===g&&(g=0===k%2?"":" ",d>k&&(f="\u3000".times(~~((d-k)/2))+g+f));return a+f+b},__Chapter:function(a,b,g,d){a="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmt(a).chapReg();return this.replace(a,function(f){return f.sr(/\u3002/)?f:f.replace("[{$b}]".chapReg("g")," ")}).replace(b.chapReg("gim",
g),d)},replaceTitle:function(a,b,g,d){var f=a||"\n\n",k=b||"";b=regChapter;var n=configs.regSkipTitle;d&&(b.s=b.sn,b.es=b.e);var m=function(e,c){e=e.replace(/  +/g," ").replace("^[{$sep}]+".chapReg(),"");if(0===e.length)return"";if(e.sr(/^\uff08?(\d{1,3})\uff09?$/))return e.replace(/^\uff08?(\d{1,3})\uff09?$/,function(h){return"\uff08"+h.zeroize(2)+"\uff09"});e=e.replace(/([^\d\.])[ \u00b7]([\u4e0a\u4e2d\u4e0b]|[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e]{1,5})$/,"$1\uff08$2\uff09").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,
"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,"\u3010\u6ce8$1\u3011").replace(/([^\d\.])(\d{1,2}\/\d{1,2})$/,"$1\uff08$2\uff09").replace(/([^\d\.]) ?\b(\d{1,2})$/,"$1\uff08$2\uff09").replace(/[ \u00b7]?\b([IVXC]{1,6})\b$/i,function(h,l){return"\uff08"+l.toUpperCase()+"\uff09"});return checkNull(c)?configs.Divide+e:e},p=function(e,c){return e.sr(n[c||"t0"])};a=this.cleanSpace("^{$ts}".chapReg()).__Chapter(b.t0,"^{$f}({$t0})(?:{$s}|$)$","",function(e,c){return c.setAlign(f,
k,g)}).__Chapter(b.t1.join("|"),"^{$f}({$t1})({$s}{$e}|{$sn}$)$","|",function(e,c,h){return h.sr(/^[!\?\uff01\uff1f\u3002]{1,3}$/)||p(e)||p(e,"t1")?e:(c+m(h)).setAlign(f,k,g)}).__Chapter(b.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(e,c,h,l){l=l.trims();if(l.sr(/^(?:\u5b8c|\u5b8c\u7ed3|\u5f85\u7eed|\u672a\u5b8c)$/))return"\u3010"+c+"\u00b7"+l+"\u3011";c=c.__chapterFullNumber();if(p(e)||c.sr(/^[\-\u2014]{2,4}/)||!d&&l.sr(/^[\uff01\uff1f\u3002\u2026]{1,3}$/)||!h&&(p(e,"t2")||!d&&l.sr(/[\uff0c]|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/)))return e;
c.sr("{$n4}[{$c}]".chapReg())||(c="\u7b2c"+c.replace(/^\u7b2c+| /g,""));c=c.replace(/[0-9]+/,function(r){return r.zeroize(2)});return(c+m(l)).setAlign(f,k,g)}).__Chapter(b.t3,"^{$f}{$t3}({$e}|$)$","",function(e,c,h){c=c.__chapterFullNumber();if(p(e))return e;c=c.zeroize(2);return(c+m(h,"no")).setAlign(f,k,g)});if("center"===g||"break"===g)return a;var q=strChapter.crt;return a.__Chapter(b.t4,"^{$f}{$t4}{$sn}({$e}|$)$","",function(e,c,h,l){return f+"\u7b2c"+h+c+m(l)+k}).__Chapter(b.t5,"^{$f}{$t5}{$sn}({$e}|$)$",
"",function(e,c,h){c=c.__chapterFullNumber().zeroize(2);return f+"\u7b2c"+c+q+m(h)+k}).__Chapter(b.t6,"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(e,c,h){h=h.trims();var l=/^[\uff01\uff1f\u3002]{1,3}$/;if(e.sr(/\u3002/)||h.sr(l)||p(e)||p(e,"t2"))return e;c=c.__chapterFullNumber();l=c.sr(/^\d+/)?/[\uff01\uff1f\u3002]$/:/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/;if(h.sr(l)||e.cleanSpace().eachRegTest(n.t6))return e;c=c.zeroize(2);return f+"\u7b2c"+c+q+m(h)+k})},replaceTitleError:function(){var a=
function(n,m){return n.replace("^{$f}\u7b2c({$zz})[{$crt}](?:\uff1a|$)".fmt(m).chapReg(),"$1\u3001").replace("^{$f}({$zz})[\uff1a\u3001\u3002.,]".fmt(m).chapReg(),"$1\u3001").replace(/^0{1,4}/gm,"").replace(/\u3001$/gm,"").replace(/\n\n+/gm,"\n")},b="(?:^{$f}\u7b2c{$n1}[{$crt}](?:\uff1a.{0,40}|$)$\\n+|^{$f}{$n1}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),g="(?:^{$f}\u7b2c{$n3}[{$crt}](?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n3}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),
d="(?:\\n+^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+){2,}".chapReg(),f="(^{$f}(?:{$w1}|{$w3})(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+)\\1".chapReg("gm"),k="(^{$f}\uff08(?:{$w1}|{$w3})\uff09(?:.{0,40}|$)$\\n+)\\1".chapReg("gm");return this.replace(b,function(n){return a(n,"{$n1}")}).replace(g,function(n){return a(n,"{$n3}")}).replace("\\n\\n((?:{$n1}|{$n3})\u3001?)".chapReg(),"$1").replace(d,function(n){return n.replace(/\n+/gm,"\n")}).replace(f,function(n,m){return m.replaceTitle("\n\n",
"")}).replace(k,function(n,m){return m.replaceTitle("\n\n","")})}});
