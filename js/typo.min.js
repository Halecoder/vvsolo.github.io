Object.assign(String.prototype,{replaceInit:function(){return(this.trim()+"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.convertEngLine().__endFix().replaces(config.rEnd).replaceFinish()},replaceFinish:function(){var r="」』”’",n="「『“‘";return this.replace(/^[」』”’]/gm,function(e){return n.charAt(r.indexOf(e))}).replace(/[「『“‘](?:。|！|？|……|——|~~|$)$/gm,function(e){return r.charAt(n.indexOf(e.charAt(0)))+e.slice(1)}).replace(/\n\n\n+/g,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},replaceHook:function(e){var r,n=this;for(r in e)switch(r){case"find":case"skip":break;case"at":n=n.replaceAt(e.at);break;case"rp":n=n.replace(e.rp[0],e.rp[1]);break;case"rps":n=n.replaces(e.rps);break;case"mu":n=n.matchUpper(e.mu);break;case"mr":n=n.cleanSpace(e.mr);break;case"ml":n=n.matchLower(e.ml);break;case"mf":n=n.matchFirstUpper(e.mf);break;case"lc":switch(e.lc){case"u":n=n.toUpperCase();break;case"l":n=n.toLowerCase();break;case"f":n=n.toLowerCase().matchUpper(/\b[a-z]/g)}}return n},__endFix:function(){var e=this;return config.rEndFix.forEach(function(r){e="find"in r?e.replace(r.find,function(e){return"skip"in r&&e.eachArrayRegTest(r.skip)?e:e.replaceHook(r)}):e.replaceHook(r)}),e},replaceSpace:function(){return this.cleanSpace(config.hanSpace,/ +/g)},replaceSeparator:function(){return this.replaces(config.rSeparator).replace(/@@@@+/g,config.Separator).replace(/!@!@!@!@!/g,config.tSeparator)},replaceQuotes:function(){return this.replace(config.enSep,"$1〔※@※〕$2").replaces(config.rQuotes).replace(/〔※@※〕/g,"'")},replaceCNQuotes:function(){return this.replaceQuotes().replaceAt(config.cnQuotes)},convertESQuotes:function(){return this.replaceAt(config.cnQuotes,!0)},convertCNQuotes:function(){return this.replaceAt(config.cnQuotes)},matchUpper:function(e){return this.replace(e,function(e){return e.toUpperCase()})},matchFirstUpper:function(e){return this.replace(e,function(e){return e.toLowerCase().matchUpper(/\b[a-z]/g)})},matchLower:function(e){return this.replace(e,function(e){return e.toLowerCase()})},convertEngLine:function(){var r=config.rEng;return this.replace(r.Line,function(e){return e.find(/^[“「][a-zA-Z]{1,6}(?:。|[！？]{1,3}|……|——)[」”]$/m)||e.findCount(r.LineSkip)<2||!e.find(/[,， ]/)||e.find(/[《》]/)||e.find(/[“「](?:。|[！？]{1,3}|……|——)[」”]/)?e:e.replaceAt(config.halfPuns).replaces(config.halfSymbol).matchLower(r.PunAfter).matchUpper(/[\.\?\!\:\&] ?[a-z]/g).matchFirstUpper(/\([^\)]+\)/g).trim()})},convertEnglish:function(){var t,c=config.rEng,a=c.Special.toLowerCase(),i=c.Unit.toLowerCase(),r="[{$enSep}]+".comReg("g");return this.matchLower(/[A-Z]/g).matchUpper(/\b[a-z]/g).replace(c.Sep,function(e){return e.replace(r,"'")}).replace(c.NameSep,function(e){return e.replace(r,"'")}).matchUpper(c.Bracket).replace(c.PunFix,function(e){return-1<e.indexOf("'")?e.matchLower(/ [A-Z]/g):e}).replace(c.Quote,function(e){return e.matchLower(/( |[a-z]{2}，)[A-Z]/g)}).replace(c.Model,function(e){return e.find(/\d/)?e.toUpperCase():e}).matchUpper(("\\b(?:"+c.Upper+")\\b").getReg("gi")).replace(("\\b("+c.Special+")(\\d{1,4}[a-z]{0,6})?\\b").getReg("gi"),function(e,r,n){return t=("|"+a+"|").indexOf("|"+r.toLowerCase()+"|")+1,("|"+c.Special+"|").substr(t,r.length)+(n&&n.toUpperCase()||"")}).replace(("\\b(\\d[0-9。.]* ?)("+c.Unit+")\\b").getReg("gi"),function(e,r,n){return t=("|"+i+"|").indexOf("|"+n.toLowerCase()+"|")+1,r+("|"+c.Unit+"|").substr(t,n.length)}).replace(c.Honor,function(e){return e.toLowerCase().matchUpper(/\b[a-z]/g).replace(/。/g,".")}).matchUpper(c.Continuou).replace(c.Suffix,function(e){return e.toLowerCase().replace(/。/g,".")}).matchLower(c.Structural).matchUpper(c.Single).replace(c.NameFix,function(e){return e.slice(0,e.length-1)+e.slice(-1).toUpperCase()}).replace(c.LatinAfter,function(e){return e.matchLower(/\b[a-zA-Z]*/g)}).replace(c.Overlap,function(e,r){return e.replace(r.getReg("gi"),r.matchFirstUpper())}).matchFirstUpper(/(?:^[“「"\']?)\b[a-zA-Z]+ /gm)},convertNumberLetter:function(){return this.replace(/([Ａ-Ｚ][ａ-ｚ]+)(?=[Ａ-Ｚ][ａ-ｚ]+)/g,"$1 ").replaceAt(config.sNumberLetter)},__chapterFullNumber:function(){return this.replace(config.regFullNumberTitle,function(e){return e.replaceAt(config.sNumber)})},convertFullNumberLetter:function(){return this.replaceAt(config.sNumberLetter,!0).__chapterFullNumber()},convertUnicode:function(){return this.replace(/(?:[＆&]#[xX]|\\[uU]?)[\da-fA-F]{4}[;；]?/g,function(e){return unescape("%u"+e.replace(/\W/g,"").replace(/^[uxUX]/,""))}).replace(/\\[xX][\da-fA-F]{2}/g,function(e){return unescape("%u00"+e.replace(/\\[xX]/,""))}).replace(/[＆&]#\d+[;；]/g,function(e){return String.fromCharCode(e.replace(/\D/g,""))}).replace(/(?:[%％][\da-fA-F]{2})+/g,function(r){try{return decodeURIComponent(r.replace(/％/g,"%"))}catch(e){return r}})},convertHtmlEntity:function(){return this.replace(config.regHtmlEntity,function(e){var r=e.replace(/\W/g,"");return 0<(r=config.sHtmlEntity[r]||config.sHtmlEntity[r.toLowerCase()]||0)?String.fromCharCode(r):e})},convertVariant:function(){return this.replaceAt(config.sVariants)},convertSerialNumber:function(){var r=config.sSerialNumber,n=r[1].split("|");return this.replace(("["+r[0]+"]").getReg(),function(e){return"（"+(n[r[0].indexOf(e)]||"")+"）"})},convertPunctuation:function(){return this.replaceAt(config.punSymbol).replaces(config.punSymbolFix)},setAlign:function(e,r,n){var t=2*config.Linenum,c=this.trims(),a=c.len();return a<t&&("center"===n?c="　".repeat(~~((t-a)/4))+(a%4==0?" ":"")+c:"right"===n&&(c="　".repeat(~~((t-a)/2))+(a%2==0?"":" ")+c)),(e||"")+c+(r||"")},__Chapter:function(e,r,n,t){var e="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$s}[{$b.0}]?(?:{$e})[{$b.1}]?)?$".fmt(e).chapReg(),c=/，|。$|(?:完|完结|待续|未完|终)$/;return this.replace(e,function(e){var r=e.trim().replace("[{$b}]".chapReg("g")," ");return-1<r.search(c)?e:r}).replace(r.chapReg("gm",n),t)},__chaSkip:function(e){return this.eachArrayRegTest(config.regSkipTitle[e||"t0"])},replaceTitle:function(c,a,i,p){c=c||"\n\n",a=a||"";var e=this,r=regChapter;p&&(r.s=r.sn,r.es=r.e);function o(e){return e.replaceAt(config.sNumber).replace(/\b\d\b/g,"0$&")}function u(e,r){return 0===(e=e.replace(/  +/g," ").replace("^[{$sep}]+".chapReg(),"")).length?"":/^\d+$/.test(e)?e.replace(RegExp["$&"],function(e){return config.Divide+(20<~~e?e:"（"+o(e)+"）")}):(e=e.replace(/([^\d\.])[ ·—-]([上中下终終完]|[零一二三四五六七八九十百]{1,5})$/,"$1（$2）").replace(/^(?:[上中下终終完])$/,"（$&）").replace(" (?=[{$han}]{2,})".comReg("g"),"，").replace(" (?=[{$han}])".comReg("g"),"").replace(/【?注(\d{1,2})】?/g,"【注$1】").replace(/([^\w\.\-—·])(\d{1,2}\/\d{1,2})$/,"$1（$2）").replace(/([^\w\.\-—·])[ —-]?\b([012]?[0-9])$/,"$1（$2）").replace(/（\d{1,3}）$/,o).replace(/[ ·]\b[IVXC]{1,6}\b$/i,function(e){return"（"+e.slice(1).toUpperCase()+"）"}),void 0===r?config.Divide+e:e)}var l="{$n4}[{$c}]".chapReg(),e=e.cleanSpace("^{$f}{$ts}".chapReg()).__Chapter(r.t0,"^{$f}({$t0}){$sn}$","",function(e,r){return r.setAlign(c,a,i)}).__Chapter(r.t1.join("|"),"^{$f}({$t1})(之{$e}|{$s}{$e}|{$sn}$)$","|",function(e,r,n){return n.find(/^[\!\?！？。]{1,3}$/)||e.__chaSkip("t0")||e.__chaSkip("t1")?e:(r.find(/番外|同人|里番|[外前后][传傳]/)&&n.find(/^之/)?r+n:r+u(n)).setAlign(c,a,i)}).__Chapter(r.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(e,r,n,t){return(t=t.trims()).find(/^(?:完|完结|待续|未完|终)$/)?"【"+r+"·"+t+"】":r.find(/^[\-\—]{2,4}/)||e.__chaSkip("t0")||e.__chaSkip("t2")||!p&&t.find(/^[！？。…]{1,3}$/)||!n&&!p&&t.find(/，/)||!r.find(/^第/)&&t.find(/[！？。…’”』」]{1,3}$/)?e:(r.find(l)||(r="第"+r.replace(/^第+| /g,"")),(o(r)+u(t)).setAlign(c,a,i))}).__Chapter(r.t3,"^{$f}{$t3}({$e}|$)$","",function(e,r,n){return e.__chaSkip("t0")?e:(o(r)+u(n,"no")).setAlign(c,a,i)});if("center"===i||"break"===i)return e;var t=strChapter.crt;return e.__Chapter(r.t4,"^{$f}{$t4}{$sn}({$e}|$)$","",function(e,r,n,t){return c+"第"+n+r+u(t)+a}).__Chapter(r.t5,"^{$f}{$t5}{$sn}({$e}|$)$","",function(e,r,n){return c+"第"+o(r)+t+u(n)+a}).__Chapter(r.t6,"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(e,r,n){return n=n.trims(),r=o(r),e.find(/。/)||n.find(/^[！？。]{1,3}$/)||e.__chaSkip("t0")||e.__chaSkip("t2")||n.find(r.find(/^\d+/)?/[！？。]$/:/[！？。…’”』」]$/)||e.cleanSpace().__chaSkip("t6")?e:c+"第"+r+t+u(n)+a})},replaceTitleError:function(){function r(e,r){return-1<e.search(/\n\d+[、，。\.\,]\d/)?e:e.replace("^第({$zz}){$crt}(?:：|……$|$)".fmt(r).chapReg(),"$1、").replace("^第({$zz}){$crt}……".fmt(r).chapReg(),"$1、……").replace("^({$zz})[：、。.,]".fmt(r).chapReg(),"$1、").replace(/^0{1,4}/gm,"").replace(/、$/gm,"").replace(/\n\n+/g,"\n")}function e(e){return(e=e.replace(/\n+/g,"\n").split("\n"))[0].length>e[1].length?e[0]:e[1]}var n="(?:^第{$n1}{$crt}(?:[：].{0,40}|$)$\\n+|^{$n1}(?:[：、。\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),t="(?:^第{$n3}{$crt}(?:[：].{0,40}|$)$\\n+|^{$n3}(?:[：、。\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),c="(?:\\n+^（(?:{$n2}|{$n3})）(?:.{0,40}|$)$\\n+){2,}".chapReg(),a="(?:^第{$n1}{$crt}……\\n+)+".chapReg(),i="(?:^第[0-9]{1,5}{$crt}$\\n+){2,}".chapReg(),p="(^(?:{$w1}|{$w3})(?:[：、。\\.\\,].{0,40}|$)$\\n+)\\1".chapReg("g"),o="(^（(?:{$w1}|{$w3})）(?:.{0,40}|$)$\\n+)\\1".chapReg("g"),u="^({$t91}[{$c.2}]{$sn})(?:{$e}|$)$\\n+\\1.*$".chapReg("gm"),l="^{$t3}(?:{$e}|$)$\\n+\\1.*$".chapReg("gm");return this.replace(u,e).replace(l,e).replace(n,function(e){return r(e,"{$n1}")}).replace(t,function(e){return r(e,"{$n3}")}).replace(c,function(e){return e.replace(/\n+/g,"\n")}).replace(a,function(e){return e.replace("^第({$n1}){$crt}".chapReg(),"$1、")}).replace(i,function(e){return e.replace("第|{$crt}".chapReg("g"),"")}).replace("\\n\\n((?:{$n1}|{$n3})、?)".chapReg(),"$1").replace(p,function(e,r){return r.replaceTitle("\n\n","")}).replace(o,function(e,r){return r.replaceTitle("\n\n","")})}});