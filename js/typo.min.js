extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.convertEngLine().replaces(configs.rEnd).__endFixed().replaceFinish()},replaceFinish:function(){return this.replace(/^[\u300d\u300f\u201d\u2019]/gm,function(a){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(a))}).replace(/[\u300c\u300e\u201c\u2018](?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,function(a){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(a.charAt(0)))+
a.substring(1)}).replace(/\uff1a([\u201d\u300d])\n/g,function(a){return a.replaceAt(["\u201d\u300d","\u201c\u300c"])}).replace(/\n\n\n+/g,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__endFixed:function(){var a=configs.rEndFixed;return this.replace(a.Latitude,function(b){return b.replaceAt(a.LatitudeAt)}).replace(a.Number,function(b){b=b.replaceAt(a.NumberAt);/\d+,\d{3}/.test(b)||(b=b.replace(/,/g,"\uff0c"));return b}).replace(a.Time,function(b){return b.replaceAt(a.TimeAt).matchUpper(/[apm]/g)}).replace(a.Dates,
function(b){return b.replaceAt(a.DatesAt)})},replaceSpace:function(){return this.cleanSpace(configs.hanSpace)},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@@{3,}/g,configs.Separator)},replaceQuotes:function(a){var b=this.replace(configs.enSep,"$1\u3014\u203b@\u203b\u3015$2").replaces(configs.rQuotes).replace(/\u3014\u203b@\u203b\u3015/g,"'");return"cn"===a?b.replaceAt(configs.cnQuotes):b},matchUpper:function(a){return this.replace(a,function(b){return b.toUpperCase()})},
matchFirstUpper:function(a){return this.matchUpper(/\b[a-z]/g)},matchLower:function(a){return this.replace(a,function(b){return b.toLowerCase()})},__convertEnglish:function(){return this.replaceAt(configs.halfPuns).replaces(configs.halfSymbol).matchLower(configs.findEng.PunAfter).matchUpper(/[\.\?!:&] ?[a-z]/g).trim()},convertEngLine:function(){var a=configs.findEng;return this.replace(a.Line,function(b){return b.find(/^[\u201c\u300c][a-z]{1,6}(?:\u3002|[\uff01\uff1f]{1,3}|\u2026\u2026|\u2014\u2014)[\u300d\u201d]$/mi)||
2>b.findCount(a.LineSkip)||!b.find(/[,\uff0c ]/)?b:b.replaceAt(configs.halfPunsOther).__convertEnglish()})},convertEnglish:function(){var a=configs.findEng,b=a.Word,h;return this.matchLower(/[A-Z]/g).matchFirstUpper().replace(a.Sep,function(c){return c.matchLower(/[A-Z]/g).matchUpper(/^[a-z]/).matchLower(/ [A-Z]/g).replace("[{$enSep}]+".comReg("g"),"'")}).replace(a.Bracket,function(c){return-1<c.indexOf(" ")?c:c.toUpperCase()}).replace(a.PunFix,function(c){return-1<c.indexOf("'")?c.matchLower(/ [A-Z]/g):
c}).replace(/\b[\w\-~\uff5e]+\b/g,function(c){return c.find(/\d/)?c.toUpperCase():c}).replace(a.HonorWord,function(c){return c.matchFirstUpper().replace(/\u3002/g,".")}).matchUpper(("\\b(?:"+a.WordUpper+")\\b").getReg("gi")).replace(("\\b("+b+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(c,e,m){h=("|"+b.toLowerCase()+"|").indexOf("|"+e.toLowerCase()+"|")+1;return("|"+b+"|").substr(h,e.length)+m.toUpperCase()}).matchUpper(a.Continuous).replace(a.LowerExt,function(c){return c.toLowerCase().replace(/\u3002/g,
".")}).replace(a.Site,function(c){return c.toLowerCase().replaceAt(a.SiteFix)}).replaces(a.WordFix).matchLower(("\\b(?:"+a.WordOnlyLower+")\\b").getReg("gi")).matchUpper(/\b[a-z]\b/g).replace(/^[a-z]+ /gim,function(c){return c.matchUpper(/\b[a-z]/gi)})},convertNumberLetter:function(a){return this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,"$1 ").replaceAt(configs.sNumberLetter)},__chapterFullNumber:function(){return this.replace(configs.regFullNumberTitle,function(a){return a.replaceAt(configs.sNumber)})},
convertFullNumberLetter:function(){return this.replaceAt(configs.sNumberLetter,!0).__chapterFullNumber()},convertUnicode:function(){return this.replace(/(?:[\uff06&]#x|\\u?)([\da-f]{4})[;\uff1b]?/gi,function(a,b){return unescape("%u"+b)}).replace(/\\x([\da-f]{2})/gi,function(a,b){return unescape("%u00"+b)}).replace(/[\uff06&]#(\d+)[;\uff1b]/g,function(a,b){return String.fromCharCode(b)}).replace(/(?:[%\uff05][\da-f]{2})+/gi,function(a){try{return decodeURIComponent(a.replace(/\uff05/g,"%"))}catch(b){return a}})},
convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,function(a,b){return configs.sHtmlEntity[b]||configs.sHtmlEntity[b.toLowerCase()]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){var a=configs.sSerialNumber,b=a[1].split("|");return this.replace(("["+a[0]+"]").getReg(),function(h){return"\uff08"+(b[a[0].indexOf(h)]||"")+"\uff09"})},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.punSymbolFix).replaces(configs.nwSymbol)},
setAlign:function(a,b,h){var c=2*configs.Linenum,e=this.trims(),m=e.len();c>m&&("center"===h?e="\u3000".repeat(~~((c-m)/4))+(0===m%4?" ":"")+e:"right"===h&&(e="\u3000".repeat(~~((c-m)/2))+(0===m%2?"":" ")+e));return(a||"")+e+(b||"")},__Chapter:function(a,b,h,c){a="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmt(a).chapReg();return this.replace(a,function(e){return-1<e.indexOf("\u3002")?e:e.replace("[{$b}]".chapReg("g")," ")}).replace(b.chapReg("gim",h),c)},replaceTitle:function(a,
b,h,c){a=a||"\n\n";b=b||"";var e=regChapter,m=configs.regSkipTitle;c&&(e.s=e.sn,e.es=e.e);var l=function(d){return d.replaceAt(configs.sNumber).replace(/\b\d\b/,"0$&")},n=function(d,f){d=d.replace(/  +/g," ").replace("^[{$sep}]+".chapReg(),"");if(0===d.length)return"";if(d.find(/^\uff08?\d{1,3}\uff09?$/))return d.replace(/^\uff08?(\d{1,3})\uff09?$/,function(g,k){return"\uff08"+l(k)+"\uff09"});d=d.replace(/([^\d\.])[ \u00b7]([\u4e0a\u4e2d\u4e0b\u7ec8\u5b8c]|[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e]{1,5})$/,
"$1\uff08$2\uff09").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,"\u3010\u6ce8$1\u3011").replace(/([^\w\.\-\u2014])(\d{1,2}\/\d{1,2})$/,"$1\uff08$2\uff09").replace(/([^\w\.\-\u2014]) ?\b(\d{1,2})$/,"$1\uff08$2\uff09").replace(/\uff08(\d{1,3})\uff09$/,function(g){return l(g)}).replace(/[ \u00b7]?\b([IVXC]{1,6})\b$/i,function(g,k){return"\uff08"+k.toUpperCase()+"\uff09"});return checkNull(f)?configs.Divide+d:d},p=function(d,
f){return d.find(m[f||"t0"])};var q=this.cleanSpace("^{$ts}".chapReg()).__Chapter(e.t0,"^{$f}({$t0})(?:{$s}|$)$","",function(d,f){return f.setAlign(a,b,h)}).__Chapter(e.t1.join("|"),"^{$f}({$t1})({$s}{$e}|{$sn}$)$","|",function(d,f,g){return g.find(/^[!\?\uff01\uff1f\u3002]{1,3}$/)||p(d)||p(d,"t1")?d:(f+n(g)).setAlign(a,b,h)}).__Chapter(e.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(d,f,g,k){k=k.trims();if(k.find(/^(?:\u5b8c|\u5b8c\u7ed3|\u5f85\u7eed|\u672a\u5b8c|\u7ec8)$/))return"\u3010"+f+"\u00b7"+
k+"\u3011";if(f.find(/^[\-\u2014]{2,4}/)||!c&&k.find(/^[\uff01\uff1f\u3002\u2026]{1,3}$/)||p(d)||!g&&(!c&&k.find(/\uff0c|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/)||p(d,"t2")))return d;f.find("{$n4}[{$c}]".chapReg())||(f="\u7b2c"+f.replace(/^\u7b2c+| /g,""));return(l(f)+n(k)).setAlign(a,b,h)}).__Chapter(e.t3,"^{$f}{$t3}({$e}|$)$","",function(d,f,g){return p(d)?d:(l(f)+n(g,"no")).setAlign(a,b,h)});if("center"===h||"break"===h)return q;var r=strChapter.crt;return q.__Chapter(e.t4,"^{$f}{$t4}{$sn}({$e}|$)$",
"",function(d,f,g,k){return a+"\u7b2c"+g+f+n(k)+b}).__Chapter(e.t5,"^{$f}{$t5}{$sn}({$e}|$)$","",function(d,f,g){return a+"\u7b2c"+l(f)+r+n(g)+b}).__Chapter(e.t6,"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(d,f,g){g=g.trims();var k=/^[\uff01\uff1f\u3002]{1,3}$/;if(-1<d.indexOf("\u3002")||g.find(k)||p(d)||p(d,"t2"))return d;f=l(f);k=f.find(/^\d+/)?/[\uff01\uff1f\u3002]$/:/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/;return g.find(k)||d.cleanSpace().eachArrayRegTest(m.t6)?d:a+"\u7b2c"+f+r+n(g)+
b})},replaceTitleError:function(){var a="(?:^{$f}\u7b2c{$n1}[{$crt}](?:\uff1a.{0,40}|$)$\\n+|^{$f}{$n1}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),b="(?:^{$f}\u7b2c{$n3}[{$crt}](?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n3}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),h="(?:\\n+^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+){2,}".chapReg(),c="(^{$f}(?:{$w1}|{$w3})(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+)\\1".chapReg("gm"),e="(^{$f}\uff08(?:{$w1}|{$w3})\uff09(?:.{0,40}|$)$\\n+)\\1".chapReg("gm"),
m=function(l,n){return l.replace("^{$f}\u7b2c({$zz})[{$crt}](?:\uff1a|$)".fmt(n).chapReg(),"$1\u3001").replace("^{$f}({$zz})[\uff1a\u3001\u3002.,]".fmt(n).chapReg(),"$1\u3001").replace(/^0{1,4}/gm,"").replace(/\u3001$/gm,"").replace(/\n\n+/g,"\n")};return this.replace(a,function(l){return m(l,"{$n1}")}).replace(b,function(l){return m(l,"{$n3}")}).replace(h,function(l){return l.replace(/\n+/g,"\n")}).replace("\\n\\n((?:{$n1}|{$n3})\u3001?)".chapReg(),"$1").replace(c,function(l,n){return n.replaceTitle("\n\n",
"")}).replace(e,function(l,n){return n.replaceTitle("\n\n","")})}});
