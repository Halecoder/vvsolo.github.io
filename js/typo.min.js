Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.convertEngLine().replaces(configs.rEnd).__endFixed().replaceFinish()},replaceFinish:function(){return this.replace(/^[\u300d\u300f\u201d\u2019]/gm,function(a){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(a))}).replace(/[\u300c\u300e\u201c\u2018](?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,function(a){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(a.charAt(0)))+
a.substring(1)}).replace(/\n\n\n+/g,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__endFixed:function(){var a=configs.rEndFixed;return this.replace(a.Latitude,function(b){return b.replaceAt(a.LatitudeAt)}).replace(a.Number,function(b){return b.replaceAt(a.NumberAt)}).replace(a.Time,function(b){return b.replaceAt(a.TimeAt).matchUpper(/[apm]/g)}).replace(a.Date,function(b){return b.replaceAt(DateAt)})},replaceSpace:function(){return this.cleanSpace(configs.hanSpace)},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@@{3,}/g,
configs.Separator)},replaceQuotes:function(a){var b=this.replace(configs.enSep,"$1\u3014\u203b@\u203b\u3015$2").replaces(configs.rQuotes).replace(/\u3014\u203b@\u203b\u3015/g,"'");return"cn"===a?b.replaceAt(configs.cnQuotes):b},matchUpper:function(a){return this.replace(a,function(b){return b.toUpperCase()})},matchFirstUpper:function(a){return this.matchUpper(/\b[a-z]/g)},matchLower:function(a){return this.replace(a,function(b){return b.toLowerCase()})},__convertEnglish:function(){return this.replaceAt(configs.halfPuns).replaces(configs.halfSymbol).matchLower(configs.findEng.PunAfter).matchUpper(/[\.\?!:&] ?[a-z]/g).trim()},
convertEngLine:function(){var a=configs.findEng;return this.replace(a.Line,function(b){return b.find(/^[\u201c\u300c][a-z]{1,6}(?:\u3002|[\uff01\uff1f]{1,3}|\u2026\u2026|\u2014\u2014)[\u300d\u201d]$/mi)||2>b.findCount(a.LineSkip)||!b.find(/[,\uff0c ]/)?b:b.replaceAt(configs.halfPunsOther).__convertEnglish()})},convertEnglish:function(){var a=configs.findEng,b=a.Word,g;return this.matchLower(/[A-Z]/g).matchFirstUpper().replace(a.Sep,function(d){return d.matchLower(/[A-Z]/g).matchUpper(/^[a-z]/).matchLower(/ [A-Z]/g).replace("[{$enSep}]+".comReg("g"),
"'")}).replace(a.Bracket,function(d){return-1<d.indexOf(" ")?d:d.toUpperCase()}).replace(a.PunFix,function(d){return-1<d.indexOf("'")?d.matchLower(/ [A-Z]/g):d}).replace(/\b[\w\-~\uff5e]+\b/g,function(d){return d.find(/\d/)?d.toUpperCase():d}).replace(a.HonorWord,function(d){return d.matchFirstUpper().replace(/\u3002/g,".")}).matchUpper(("\\b(?:"+a.WordUpper+")\\b").getReg("gi")).replace(("\\b("+b+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(d,f,m){g=("|"+b.toLowerCase()+"|").indexOf("|"+
f.toLowerCase()+"|")+1;return("|"+b+"|").substr(g,f.length)+m.toUpperCase()}).matchUpper(a.Continuous).replace(a.LowerExt,function(d){return d.toLowerCase().replace(/\u3002/g,".")}).replace(a.Site,function(d){return d.toLowerCase().replaceAt(a.SiteFix)}).replaces(a.WordFix).matchLower(("\\b(?:"+a.WordOnlyLower+")\\b").getReg("gi")).matchUpper(/\b[a-z]\b/g).matchUpper(/^[a-z]/gm)},convertNumberLetter:function(a){a=configs.sNumberLetter;return this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,
"$1 ").replaceAt(a)},__chapterFullNumber:function(){return this.replace(configs.regFullNumberTitle,function(a){return a.replaceAt(configs.sNumber)})},convertFullNumberLetter:function(){return this.replaceAt(configs.sNumberLetter,!0).__chapterFullNumber()},convertUnicode:function(){return this.replace(/(?:[\uff06&]#x|\\u?)[\da-f]{4}[;\uff1b]?/gi,function(a){return unescape(a.replace(/[\uff06&]#x|\\u?/gi,"%u").replace(/[;\uff1b]/g,""))}).replace(/[\uff06&]#\d+[;\uff1b]/g,function(a,b){return String.fromCharCode(b)}).replace(/(?:[%\uff05][\da-f]{2})+/gi,
function(a){try{return decodeURIComponent(a.replace(/\uff05/g,"%"))}catch(b){}return a})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,function(a,b){return configs.sHtmlEntity[b]||configs.sHtmlEntity[b.toLowerCase()]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){var a=configs.sSerialNumber,b=a[1].split("|");return this.replace(("["+a[0]+"]").getReg(),function(g){return"\uff08{$zz}\uff09".fmt(b[a[0].indexOf(g)]||"")})},
convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.punSymbolFix).replaces(configs.nwSymbol)},setAlign:function(a,b,g){var d=2*configs.Linenum,f=this.trims(),m=f.len();a=a||"";b=b||"";"center"===g?(g=0===m%4?" ":"",d>m&&(f="\u3000".times(~~((d-m)/4))+g+f)):"right"===g&&(g=0===m%2?"":" ",d>m&&(f="\u3000".times(~~((d-m)/2))+g+f));return a+f+b},__Chapter:function(a,b,g,d){a="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmt(a).chapReg();return this.replace(a,
function(f){return-1<f.indexOf("\u3002")?f:f.replace("[{$b}]".chapReg("g")," ")}).replace(b.chapReg("gim",g),d)},replaceTitle:function(a,b,g,d){a=a||"\n\n";b=b||"";var f=regChapter,m=configs.regSkipTitle;d&&(f.s=f.sn,f.es=f.e);var l=function(c){return c.replaceAt(configs.sNumber).replace(/\d+/,function(e){return 10>~~e?"0"+~~e:e})},n=function(c,e){c=c.replace(/  +/g," ").replace("^[{$sep}]+".chapReg(),"");if(0===c.length)return"";if(-1<c.search(/^\uff08?\d{1,3}\uff09?$/))return c.replace(/^\uff08?(\d{1,3})\uff09?$/,
function(h,k){return"\uff08"+l(k)+"\uff09"});c=c.replace(/([^\d\.])[ \u00b7]([\u4e0a\u4e2d\u4e0b\u7ec8\u5b8c]|[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e]{1,5})$/,"$1\uff08$2\uff09").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,"\u3010\u6ce8$1\u3011").replace(/([^\d\.])(\d{1,2}\/\d{1,2})$/,"$1\uff08$2\uff09").replace(/([^\d\.]) ?\b(\d{1,2})$/,"$1\uff08$2\uff09").replace(/\uff08(\d{1,3})\uff09$/,function(h){return l(h)}).replace(/[ \u00b7]?\b([IVXC]{1,6})\b$/i,
function(h,k){return"\uff08"+k.toUpperCase()+"\uff09"});return checkNull(e)?configs.Divide+c:c},p=function(c,e){return c.find(m[e||"t0"])};var q=this.cleanSpace("^{$ts}".chapReg()).__Chapter(f.t0,"^{$f}({$t0})(?:{$s}|$)$","",function(c,e){return e.setAlign(a,b,g)}).__Chapter(f.t1.join("|"),"^{$f}({$t1})({$s}{$e}|{$sn}$)$","|",function(c,e,h){return h.find(/^[!\?\uff01\uff1f\u3002]{1,3}$/)||p(c)||p(c,"t1")?c:(e+n(h)).setAlign(a,b,g)}).__Chapter(f.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(c,e,h,k){k=
k.trims();if(k.find(/^(?:\u5b8c|\u5b8c\u7ed3|\u5f85\u7eed|\u672a\u5b8c|\u7ec8)$/))return"\u3010"+e+"\u00b7"+k+"\u3011";if(e.find(/^[\-\u2014]{2,4}/)||!d&&k.find(/^[\uff01\uff1f\u3002\u2026]{1,3}$/)||p(c)||!h&&(!d&&k.find(/\uff0c|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/)||p(c,"t2")))return c;e.find("{$n4}[{$c}]".chapReg())||(e="\u7b2c"+e.replace(/^\u7b2c+| /g,""));return(l(e)+n(k)).setAlign(a,b,g)}).__Chapter(f.t3,"^{$f}{$t3}({$e}|$)$","",function(c,e,h){return p(c)?c:(l(e)+n(h,"no")).setAlign(a,
b,g)});if("center"===g||"break"===g)return q;var r=strChapter.crt;return q.__Chapter(f.t4,"^{$f}{$t4}{$sn}({$e}|$)$","",function(c,e,h,k){return a+"\u7b2c"+h+e+n(k)+b}).__Chapter(f.t5,"^{$f}{$t5}{$sn}({$e}|$)$","",function(c,e,h){return a+"\u7b2c"+l(e)+r+n(h)+b}).__Chapter(f.t6,"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(c,e,h){h=h.trims();var k=/^[\uff01\uff1f\u3002]{1,3}$/;if(-1<c.indexOf("\u3002")||h.find(k)||p(c)||p(c,"t2"))return c;e=l(e);k=e.find(/^\d+/)?/[\uff01\uff1f\u3002]$/:/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/;
return h.find(k)||c.cleanSpace().eachArrayRegTest(m.t6)?c:a+"\u7b2c"+e+r+n(h)+b})},replaceTitleError:function(){var a="(?:^{$f}\u7b2c{$n1}[{$crt}](?:\uff1a.{0,40}|$)$\\n+|^{$f}{$n1}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),b="(?:^{$f}\u7b2c{$n3}[{$crt}](?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n3}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),g="(?:\\n+^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+){2,}".chapReg(),d="(^{$f}(?:{$w1}|{$w3})(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+)\\1".chapReg("gm"),
f="(^{$f}\uff08(?:{$w1}|{$w3})\uff09(?:.{0,40}|$)$\\n+)\\1".chapReg("gm"),m=function(l,n){return l.replace("^{$f}\u7b2c({$zz})[{$crt}](?:\uff1a|$)".fmt(n).chapReg(),"$1\u3001").replace("^{$f}({$zz})[\uff1a\u3001\u3002.,]".fmt(n).chapReg(),"$1\u3001").replace(/^0{1,4}/gm,"").replace(/\u3001$/gm,"").replace(/\n\n+/g,"\n")};return this.replace(a,function(l){return m(l,"{$n1}")}).replace(b,function(l){return m(l,"{$n3}")}).replace(g,function(l){return l.replace(/\n+/g,"\n")}).replace("\\n\\n((?:{$n1}|{$n3})\u3001?)".chapReg(),
"$1").replace(d,function(l,n){return n.replaceTitle("\n\n","")}).replace(f,function(l,n){return n.replaceTitle("\n\n","")})}});
