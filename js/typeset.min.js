var tmpRegs=["[{$hwPun}{$fwPun}w ]".comReg(),"([{$han}{$fwPun}])([0-9a-z])".comReg("i"),"([0-9a-z])([{$han}{$fwPun}])".comReg("i")],saftLeftStr="\u2620",safeReg="^{$zz}+".fmtReg(saftLeftStr,"m"),cutNum=2*configs.Linenum;
function doSplit(a,b,e){if(0===a.trim().len()||/^\u3000{2,}/gm.test(a)||/^\uff0a{5,}/gm.test(a))return a+e;if(safeReg.test(a.trim()))return a.replace(saftLeftStr.getReg(),"\n")+"\n";var c="\u3000\u3000"+a.trim();if(cutNum>c.len())return c+e;a=~~(c.len()/cutNum)+1;e="";for(var d,g,h;a--;)d=c.realSubstr(0,cutNum).replace(/[\u300c\u201c\u300a\u300e\u2018\uff08]{1,2}$/gm,function(f){c+=f;return""}),c=c.realSubstr(d.len()).replace(/^[\uff0c\u3002\uff1a\u3001\uff1b\uff1a\uff1f\uff01\uff0e\uff09\u300b\u300d\u300f]{1,2}/,
function(f){d+=f;return""}).replace(/^[\u2026\uff5e\uff0d]$/,function(f){d+=f;return""}).replace(/^[a-zA-Z]{1,2}\b/,function(f){return/[a-zA-Z]$/.test(d)?(d+=f,""):f}),g=0<d.replace(tmpRegs[0],"").length,d.len()<cutNum&&g&&(h=tmpRegs[1].test(d)?tmpRegs[1]:tmpRegs[2],d=d.replace(h,"$1 $2").replace(/[\u201c\u2018\u300e\u300c] .*[\u300d\u300f\u2019\u201d]/i,function(f){return f.replace(/([\u201c\u2018\u300e\u300c]) /g,"$1").replace(/ (?=[\u300d\u300f\u2019\u201d])/g,"")+" "}),d.len()<cutNum&&g&&(d=d.replace(/([0-9a-z]) ?/i,
"$1").replace(/ (?=[\u201c\u2018\u300e\u300c])/g,"").replace(/([\u300d\u300f\u2019\u201d]) /g,"$1"))),e+=d+"\n";return e+b}
function onTypeSetSplit(a){var b=("^[\uff08\u3010\u201c\u300c<]?(?:"+configs.endStrs+")[\uff09\u3011\u201d\u300d>]?$").getReg("gm");a=a.replaceInit().replaceAt(configs.cnQuotes).replace(/\u4f5c\u8005\uff1a.*?\n[\d\/]*[\u53d1\u767c]\u8868[\u4e8e\u65bc]\uff1a.*?\n\u662f\u5426\u9996[\u53d1\u767c]\uff1a.*?\n\u5b57[\u6570\u6578]\uff1a.*?\n/gm,"").convertNumberLetter().replaceSeparator().replace(("^"+configs.Separator+"$").getReg("gm"),function(c){return c.setAlign("","","center")}).replace(b,function(c){return c.setAlign("",
"","center")}).replace(configs.novelTitle,function(c){return c.setAlign("","","center")}).replaceTitle("","\n","center");b=a.split("\n");a="";for(var e=b.length;e--;)a=doSplit(b[e],"\n\n","\n\n")+a;a="\n"+a.replace(/^[ \u3000]+$\n/gm,"").replace(/\n\n{2,}/gm,"\n\n").replace(configs.novelAuthor,function(c){return c.trim()+"\n"}).replaceEnd().replace(/\n\n{3,}/gm,"\n\n\n");if(!$("#Check_AddTop").is(":checked"))return a;b="\u7b80"!==$("#chinese").html()?"\u4f5c\u8005\uff1a{$w}\n{$d}\u53d1\u8868\u4e8e\uff1a{$b}\n\u662f\u5426\u9996\u53d1\uff1a{$y}\n\u5b57\u6570\uff1a{$n} \u5b57\n":
"\u4f5c\u8005\uff1a{$w}\n{$d}\u767c\u8868\u65bc\uff1a{$b}\n\u662f\u5426\u9996\u767c\uff1a{$y}\n\u5b57\u6578\uff1a{$n} \u5b57\n";b=b.fmt({w:$("#inputAuthor").val().trim()||" ",b:$("#inputSite").val().trim()||" ",y:$("#Check_0").is(":checked")?"\u662f":"\u5426",d:(new Date).fmt("yyyy/MM/dd"),n:(a.length-a.findCount(allSpace)).fmt()});return b+"\n"+a}
function onTypeSetRead(a){return a.replaceInit().convertNumberLetter().replaceTitle("\n\n","","break").replaceSeparator().replace(configs.novelAuthor,"$1\n").replace(/^/gm,"\u3000\u3000").replace(/(^\u3000\u3000$\n)+/gm,"\u3000\u3000\n").replace(/\n{3,}/gm,"\n\n").replace(/^\n{2,}/,"\n")}
function editorCleanUp(a){a=a.replaceInit();$("#Check_1").is(":checked")&&(a=a.convertHtmlEntity());$("#Check_2").is(":checked")&&(a=a.convertUnicode());$("#Check_3").is(":checked")&&(a=a.convertVariant());$("#Check_4").is(":checked")&&(a=a.convertSerialNumber());$("#Check_6").is(":checked")&&(a=a.convertNumberLetter());$("#Check_7").is(":checked")&&(a=a.replaceTitle().replaceTitleError());$("#Check_5").is(":checked")&&(a=a.convertPunctuation());$("#Check_8").is(":checked")&&(a=a.replaceSpace());
$("#Check_9").is(":checked")&&(a=a.replaceSeparator());$("#Check_10").is(":checked")&&(a=a.replaceQuotes("fr"));$("#Check_11").is(":checked")&&(a=a.convertEnglish());return a.replaceEnd()}
function editorCleanUpEx(a){var b=["\n\u2620","\u2620\n"],e=("^[\\(\uff08\u3010\u3016\u201c\u300c\uff3b<](?:"+configs.endStrs+")[>\uff3d\u300d\u201d\u3017\u3011\uff09\\)]$").getReg("gm"),c=[[/([^\u3002\uff01\uff1f\u2026\u201d\u300d\u2620\uff1b\u3017\u3011]$)\n+([^\u2620])/gm,"$1$2"],[/^((?![\u7b2c][\d\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343]+|\u2620).+[\u201c\u300c][\u4E00-\u9FA5]+[\u201d\u300d]$)\n+/gm,"$1"],[/^([^\u2620]*[\u201c\u300c][^\uff0c\u3002\uff1f\uff01\u2026~\uff5e\u2500]+[\u201d\u300d]$)\n+/gm,
"$1"],[/\uff0c([\u201d\u300d])\n+/gm,"\uff0c$1"],[/\u2026\n+\u2026/gm,"\u2026\u2026"],[/\n+([\u201d\u300d])/gm,"$1"],[/\u2026([\u201c\u300c])/g,"\u2026\n$1"],[/(.$)\n+[\uff09\)]([^\uff0c\u3002\u2026\uff01\uff1f])/gm,"$1\uff09\n$2"],[/\u5206\u5377\u9605\u8bfb(\d+)/g,""],[b.join("|").getReg("gm"),"\n"],[/\u2620(?=\u7b2c[\d\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343]+\u7ae0)/g,""],[/(\u7b2c[\d\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343]+\u7ae0\uff1a)/g,
"\n$1"]];a=a.replaceInit().replaceSpace().replace(configs.novelTitle,function(d){return b[0]+d+b[1]}).replace(configs.novelAuthor,function(d){return b[0]+d+b[1]}).replaceTitle(b[0],b[1]).replaceQuotes().replaces(c).replace(e,"");return editorCleanUp(a)}
function setTitle(){var a=/^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$/g,b=$("#inputBookName").val(),e=$("#inputChapter").val(),c="";0<b.length&&(c="\u3010"+b.trim().replace(a,"")+"\u3011");0<e.length&&(c+="\uff08"+e.trim().replace(a,"")+"\uff09");$("#TitleMsg").html(c||$("#TitleMsg").attr("data-tip"))};
