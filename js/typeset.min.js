var tmpRegs=["[{$hwPun}{$fwPun}w ]".comReg(),"([{$han}{$fwPun}])([0-9a-z])".comReg("i"),"([0-9a-z])([{$han}{$fwPun}])".comReg("i")];var saftLeftStr="☠",safeReg="^{$zz}+".fmtReg(saftLeftStr,"m"),cutNum=configs.Linenum*2;function doSplit(e,n,t){if(e.trim().len()===0){return e+t}if(/^　{2,}/gm.test(e)||/^＊{5,}/gm.test(e)){return e+t}if(safeReg.test(e.trim())){return e.replace(saftLeftStr.getReg(),"\n")+"\n"}var r="　　"+e.trim();if(cutNum>r.len())return r+t;var c=~~(r.len()/cutNum)+1,i="",a,l,u;while(c--){a=r.realSubstr(0,cutNum).replace(/[「“《『‘（]{1,2}$/gm,function(e){r+=e;return""});r=r.realSubstr(a.len()).replace(/^[，。：、；：？！．）》」』]{1,2}/,function(e){a+=e;return""}).replace(/^[…～－]$/,function(e){a+=e;return""}).replace(/^[a-zA-Z]{1,2}\b/,function(e){if(/[a-zA-Z]$/.test(a)){a+=e;return""}else{return e}});l=a.replace(tmpRegs[0],"").length>0;if(a.len()<cutNum&&l){u=tmpRegs[1].test(a)?tmpRegs[1]:tmpRegs[2];a=a.replace(u,"$1 $2").replace(/[“‘『「] .*[」』’”]/i,function(e){return e.replace(/([“‘『「]) /g,"$1").replace(/ (?=[」』’”])/g,"")+" "});if(a.len()<cutNum&&l){a=a.replace(/([0-9a-z]) ?/i,"$1").replace(/ (?=[“‘『「])/g,"").replace(/([」』’”]) /g,"$1")}}i+=a+"\n"}return i+n}function onTypeSetSplit(e){var n=("^[（【“「<]?(?:"+configs.endStrs+")[）】”」>]?$").getReg("gm");e=e.replaceInit().replaceAt(configs.cnQuotes).replace(/作者：.*?\n[\d\/]*[发發]表[于於]：.*?\n是否首[发發]：.*?\n字[数數]：.*?\n/gm,"").convertNumberLetter().replaceSeparator().replace(("^"+configs.Separator+"$").getReg("gm"),function(e){return e.setAlign("","","center")}).replace(n,function(e){return e.setAlign("","","center")}).replace(configs.novelTitle,function(e){return e.setAlign("","","center")}).replaceTitle("","\n","center");var t=e.split("\n"),r="",c=t.length;while(c--){r=doSplit(t[c],"\n\n","\n\n")+r}r="\n"+r.replace(/^[ 　]+$\n/gm,"").replace(/\n\n{2,}/gm,"\n\n").replace(configs.novelAuthor,function(e){return e.trim()+"\n"}).replaceEnd().replace(/\n\n{3,}/gm,"\n\n\n");if(!$("#Check_AddTop").is(":checked"))return r;var i=$("#chinese").html()!=="简"?"作者：{$w}\n{$d}发表于：{$b}\n是否首发：{$y}\n字数：{$n} 字\n":"作者：{$w}\n{$d}發表於：{$b}\n是否首發：{$y}\n字數：{$n} 字\n";i=i.fmt({w:$("#inputAuthor").val().trim()||" ",b:$("#inputSite").val().trim()||" ",y:$("#Check_0").is(":checked")?"是":"否",d:(new Date).fmt("yyyy/MM/dd"),n:(r.length-r.findCount(allSpace)).fmt()});return i+"\n"+r}function onTypeSetRead(e){return e.replaceInit().convertNumberLetter().replaceTitle("\n\n","","break").replaceSeparator().replace(configs.novelAuthor,"$1\n").replace(/^/gm,"　　").replace(/(^　　$\n)+/gm,"　　\n").replace(/\n{3,}/gm,"\n\n").replace(/^\n{2,}/,"\n")}function editorCleanUp(e){e=e.replaceInit();if($("#Check_1").is(":checked"))e=e.convertHtmlEntity();if($("#Check_2").is(":checked"))e=e.convertUnicode();if($("#Check_3").is(":checked"))e=e.convertVariant();if($("#Check_4").is(":checked"))e=e.convertSerialNumber();if($("#Check_6").is(":checked"))e=e.convertNumberLetter();if($("#Check_7").is(":checked")){e=e.replaceTitle().replaceTitleError()}if($("#Check_5").is(":checked"))e=e.convertPunctuation();if($("#Check_8").is(":checked"))e=e.replaceSpace();if($("#Check_9").is(":checked"))e=e.replaceSeparator();if($("#Check_10").is(":checked"))e=e.replaceQuotes("fr");if($("#Check_11").is(":checked"))e=e.convertEnglish();return e.replaceEnd()}function editorCleanUpEx(e){var n=["\n☠","☠\n"],t=("^[\\(（【〖“「［<](?:"+configs.endStrs+")[>］」”〗】）\\)]$").getReg("gm");var r=[[/([^。！？…”」\u2620；〗】]$)\n+([^\u2620])/gm,"$1$2"],[/^((?![第][\d一二三四五六七八九十百千]+|\u2620).+[“「][\u4E00-\u9FA5]+[”」]$)\n+/gm,"$1"],[/^([^\u2620]*[“「][^，。？！…~～\─]+[”」]$)\n+/gm,"$1"],[/，([”」])\n+/gm,"，$1"],[/…\n+…/gm,"……"],[/\n+([”」])/gm,"$1"],[/…([“「])/g,"…\n$1"],[/(.$)\n+[）\)]([^，。…！？])/gm,"$1）\n$2"],[/分卷阅读(\d+)/g,""],[n.join("|").getReg("gm"),"\n"],[/\u2620(?=第[\d一二三四五六七八九十百千]+章)/g,""],[/(第[\d一二三四五六七八九十百千]+章：)/g,"\n$1"]];e=e.replaceInit().replaceSpace().replace(configs.novelTitle,function(e){return n[0]+e+n[1]}).replace(configs.novelAuthor,function(e){return n[0]+e+n[1]}).replaceTitle(n[0],n[1]).replaceQuotes().replaces(r).replace(t,"");return editorCleanUp(e)}function setTitle(){var e=/^[（【“「<]|[）】”」>]$/g,n=$("#inputBookName").val(),t=$("#inputChapter").val(),r="";if(n.length>0)r="【"+n.trim().replace(e,"")+"】";if(t.length>0)r+="（"+t.trim().replace(e,"")+"）";$("#TitleMsg").html(r||$("#TitleMsg").attr("data-tip"))}