var vNum=configs.Linenum,cutNum=2*configs.Linenum;
function doSplit(a,c,d){if(1>a.len()||-1<a.search(/^\u3000\u3000+/)||-1<a.search(/^\uff0a{5,}/))return a+d;var b="\u3000\u3000"+a;if(cutNum>=b.len())return b+d;a=~~(b.length/vNum)+1;c=[];for(var g=b.findCount(/[\x00-\xff]/g),l=-1<b.replace(/^\u3000\u3000+/,"").search(/^[\x00-\xff]+$/);a--;){var f=0;var e=!0;if(l)e?(f=vNum-2,e=!1):f=vNum;else if(0<g){var h=b.substr(0,vNum);if(e=h.findCount(/[\x00-\xff]/g))if(b.substr(vNum,e).len()===2*e)f=~~(e/2);else for(e=f=Math.round(e/2);e--;)if(f++,b.substr(0,
vNum+f).len()>cutNum){f--;break}}h=b.substr(0,vNum+f).replace(/[\uff3b\u3014\u3010\uff5b\u300e\u300c\u3008\u300a]{1,2}$/,function(k){b+=k;return""});b=b.replace(h,"").replace(/^[\uff0c\u3001\u3002\uff1a\uff1b\uff1f\uff01\uff09\uff3d\u3015\u3011\uff5d\u300f\u300d\u3009\u300b\u2026\uff5e\u2014]{1,2}/,function(k){h+=k;return""});c.push(h)}return c.join("\n")+d}
function onTypeSetSplit(a){var c=("^[\uff08\u3010\u201c\u300c<]?(?:"+configs.endStrs+")[\uff09\u3011\u201d\u300d>]?$").getReg("gm"),d="";a=a.replaceInit().replaceAt(configs.cnQuotes).replace(/\u4f5c\u8005\uff1a.*?\n[\d\/]*[\u53d1\u767c]\u8868[\u4e8e\u65bc]\uff1a.*?\n\u662f\u5426\u9996[\u53d1\u767c]\uff1a.*?\n\u5b57[\u6570\u6578]\uff1a.*?\n/gm,"").convertNumberLetter().replaceSeparator().replace(("^"+configs.Separator+"$").getReg("gm"),function(b){return b.setAlign("","","center")}).replace(c,function(b){return b.setAlign("",
"","center")}).replace(configs.novelTitle,function(b){return b.setAlign("","","center")}).replaceTitle("","\n","center").split("\n").each(function(b){d+=doSplit(b,"\n\n","\n\n")});d="\n"+d.replace(/^[ \u3000]+$\n/gm,"").replace(/\n\n{2,}/gm,"\n\n").replace(configs.novelAuthor,function(b){return b.trim()+"\n"}).replaceEnd().replace(/\n\n{3,}/gm,"\n\n\n");if(!$("#Check_AddTop").is(":checked"))return d;a="\u7b80"!==$("#chinese").html()?"\u4f5c\u8005\uff1a{$w}\n{$d}\u53d1\u8868\u4e8e\uff1a{$b}\n\u662f\u5426\u9996\u53d1\uff1a{$y}\n\u5b57\u6570\uff1a{$n} \u5b57\n":
"\u4f5c\u8005\uff1a{$w}\n{$d}\u767c\u8868\u65bc\uff1a{$b}\n\u662f\u5426\u9996\u767c\uff1a{$y}\n\u5b57\u6578\uff1a{$n} \u5b57\n";a=a.fmt({w:$("#inputAuthor").val().trim()||" ",b:$("#inputSite").val().trim()||" ",y:$("#Check_0").is(":checked")?"\u662f":"\u5426",d:(new Date).fmt("yyyy/MM/dd"),n:(d.length-d.findCount(/[\u3000\s]/g)).fmt()});return a+"\n"+d}
function onTypeSetRead(a){return a.replaceInit().convertNumberLetter().replaceTitle("\n\n","","break").replaceSeparator().replace(configs.novelAuthor,"$1\n").replace(/^/gm,"\u3000\u3000").replace(/(^\u3000\u3000$\n)+/gm,"\u3000\u3000\n").replace(/\n{3,}/gm,"\n\n").replace(/^\n{2,}/,"\n")}
function editorCleanUp(a){a=a.replaceInit();$("#Check_1").is(":checked")&&(a=a.convertHtmlEntity());$("#Check_2").is(":checked")&&(a=a.convertUnicode());$("#Check_3").is(":checked")&&(a=a.convertVariant());$("#Check_4").is(":checked")&&(a=a.convertSerialNumber());$("#Check_6").is(":checked")&&(a=a.convertNumberLetter());$("#Check_7").is(":checked")&&(a=a.replaceTitle().replaceTitleError());$("#Check_5").is(":checked")&&(a=a.convertPunctuation());$("#Check_8").is(":checked")&&(a=a.replaceSpace());
$("#Check_9").is(":checked")&&(a=a.replaceSeparator());$("#Check_10").is(":checked")&&(a=a.replaceQuotes("fr"));$("#Check_11").is(":checked")&&(a=a.convertEnglish());return a.replaceEnd()}
function editorCleanUpEx(a){var c=["\n\u2620","\u2620\n"],d=("^[\\(\uff08\u3010\u3016\u201c\u300c\uff3b<](?:"+configs.endStrs+")[>\uff3d\u300d\u201d\u3017\u3011\uff09\\)]$").getReg("gm"),b=[[/([^\u3002\uff01\uff1f\u2026\u201d\u300d\.!\?~\u0022\u0027\u2620\uff1b\u3017\u3011]$)\n+([^\u2620])/gm,"$1$2"],[/^((?![\u7b2c][\d\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343]+|\u2620).+[\u201c\u300c][\u4E00-\u9FA5]+[\u201d\u300d]$)\n+/gm,"$1"],[/^([^\u2620]*[\u201c\u300c][^\uff0c\u3002\uff1f\uff01\u2026~\uff5e\u2500]+[\u201d\u300d]$)\n+/gm,
"$1"],[/\uff0c([\u201d\u300d])\n+/gm,"\uff0c$1"],[/\u2026\n+\u2026/gm,"\u2026\u2026"],[/\n+([\u201d\u300d])/gm,"$1"],[/\u2026([\u201c\u300c])/g,"\u2026\n$1"],[/(.$)\n+[\uff09\)]([^\uff0c\u3002\u2026\uff01\uff1f])/gm,"$1\uff09\n$2"],[/\u5206\u5377\u9605\u8bfb(\d+)/g,""],[c.join("|").getReg("gm"),"\n"],[/\u2620(?=\u7b2c[\d\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343]+\u7ae0)/g,""],[/(\u7b2c[\d\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e\u5343]+\u7ae0\uff1a)/g,
"\n$1"]];a=a.replaceInit().replaceSpace().replace(configs.novelTitle,function(g){return c[0]+g+c[1]}).replace(configs.novelAuthor,function(g){return c[0]+g+c[1]}).replaceTitle(c[0],c[1]).replaceQuotes().replaces(b).replace(d,"");return editorCleanUp(a)}
function setTitle(){var a=/^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$/g,c=$("#inputBookName").val(),d=$("#inputChapter").val(),b="";0<c.length&&(b="\u3010"+c.trim().replace(a,"")+"\u3011");0<d.length&&(b+="\uff08"+d.trim().replace(a,"")+"\uff09");$("#TitleMsg").html(b||$("#TitleMsg").attr("data-tip"))};
