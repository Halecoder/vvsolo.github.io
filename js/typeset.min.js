var tmpRegs=["[{$hwPun}{$fwPun}w ]".fmtReg(regCommon),"([{$han}{$fwPun}])([0-9a-z])".fmtReg(regCommon,"i"),"([0-9a-z])([{$han}{$fwPun}])".fmtReg(regCommon,"i")];
function doSplit(a,b,c){if(0===a.trim().len()||/^\u3000{2,}/gm.test(a)||a==="\uff0a".times(35))return a+c;var f="",e="\u3000\u3000"+a.trim();a=0;var g=g||2*configs.Linenum;if(g>e.len())return e+c;for(c=Math.floor(e.len()/g)+1;a<c;a++){var d=e.realSubstring(0,g);d=d.replace(/([\u300c\u201c\u300a\u300e\u2018\uff08]){1,2}$/gm,function(a){e+=a;return""});e=e.realSubstring(d.len()).replace(/^([\uff0c\u3002\uff1a\u3001\uff1b\uff1a\uff1f\uff01\uff0e\uff09\u300b\u300d\u300f]{1,2})/gm,function(a){d+=a;return""}).replace(/^([\u2026\uff5e\uff0d])$/gm,
function(a){d+=a;return""});var h=0<d.replace(tmpRegs[0],"").length;d.len()<g&&h&&(h=tmpRegs[1].test(d)?tmpRegs[1]:tmpRegs[2],d=d.replace(h,"$1 $2").replace(/([\u201c\u2018\u300e\u300c][0-9a-z ]+[\u300d\u300f\u2019\u201d])/i,function(a){return a.replace(/ /g,"")+" "}));f+=d+"\n"}return f+b}
function doTidy(a){var b=("^([\uff08\u3010\u201c\u300c<]?)("+configs.endStrs+")([\uff09\u3011\u201d\u300d>]?)$").getReg("gm");a=a.replaceInit().replaceAt(configs.cnQuotes).replace(/\u4f5c\u8005\uff1a.*?\n[\d\/]*[\u53d1\u767c]\u8868[\u4e8e\u65bc]\uff1a.*?\n\u662f\u5426\u9996[\u53d1\u767c]\uff1a.*?\n\u5b57[\u6570\u6578]\uff1a.*?\n/gm,"").convertNumberLetter().replaceSeparator().replace(("^"+configs.Separator+"$").getReg("gm"),function(a){return a.setAlign("","","center")}).replace(b,function(a){return a.setAlign("",
"","center")}).replaceTitle("","","center");b=a.split("\n");a="";for(var c=0;c<b.length;c++)a+=doSplit(b[c],"\n","\n\n");a=a.replace(configs.novelAuthor,function(a){return a.trim()}).replace(/^([ \u3000]+)$\n/gm,"").replace(/\n{3,}/gm,"\n\n").replace(configs.novelTitle,function(a){return a.setAlign("","\n","center")}).replaces(configs.rEnd).replace(/\n{4,}/gm,"\n\n\n");if(!$("#Check_AddTop").is(":checked"))return a;b="\u7b80"!==$("#chinese").html()?"\u4f5c\u8005\uff1a{$w}\n{$d}\u53d1\u8868\u4e8e\uff1a{$b}\n\u662f\u5426\u9996\u53d1\uff1a{$y}\n\u5b57\u6570\uff1a{$n} \u5b57\n":
"\u4f5c\u8005\uff1a{$w}\n{$d}\u767c\u8868\u65bc\uff1a{$b}\n\u662f\u5426\u9996\u767c\uff1a{$y}\n\u5b57\u6578\uff1a{$n} \u5b57\n";b=b.fmt({w:$("#inputAuthor").val().trim()||"",b:$("#inputSite").val().trim()||"",y:$("#Check_0").is(":checked")?"\u662f":"\u5426",d:(new Date).fmt("yyyy/MM/dd"),n:(a.length-a.findCount(allSpace)).fmt()});return b+"\n"+a}
function editorCleanUp(a){a=a.replaceInit();$("#Check_1").is(":checked")&&(a=a.convertHtmlEntity());$("#Check_2").is(":checked")&&(a=a.convertUnicode());$("#Check_3").is(":checked")&&(a=a.convertVariant());$("#Check_4").is(":checked")&&(a=a.convertSerialNumber());$("#Check_6").is(":checked")&&(a=a.convertNumberLetter());$("#Check_7").is(":checked")&&(a=a.replaceTitle().replaceTitleError());$("#Check_5").is(":checked")&&(a=a.convertPunctuation());$("#Check_8").is(":checked")&&(a=a.replaceSpace());
$("#Check_9").is(":checked")&&(a=a.replaceSeparator());$("#Check_10").is(":checked")&&(a=a.replaceQuotes("fr"));$("#Check_11").is(":checked")&&(a=a.convertInitial());return a.replaceEnd()}
function setTitle(){var a=/(^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$)/g,b=$("#inputBookName").val(),c=$("#inputChapter").val(),f="";0<b.length&&(f="\u3010"+b.trim().replace(a,"")+"\u3011");0<c.length&&(f+="\uff08"+c.trim().replace(a,"")+"\uff09");$("#TitleMsg").html(f||$("#TitleMsg").attr("data-tip"))};
