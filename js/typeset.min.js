var tmpRegs=["[{$hwPun}{$fwPun}w ]".fmtReg(strCommon),"([{$han}{$fwPun}])([0-9a-z])".fmtReg(strCommon,"i"),"([0-9a-z])([{$han}{$fwPun}])".fmtReg(strCommon,"i")],saftLeftStr="\u2620",safeReg="^{$zz}+".fmtReg(saftLeftStr,"m"),cutNum=2*configs.Linenum;
function doSplit(a,c,d){if(0===a.trim().len()||/^\u3000{2,}/gm.test(a)||/^\uff0a{5,}/gm.test(a))return a+d;if(safeReg.test(a.trim()))return a.replace(saftLeftStr.getReg(),"\n")+"\n";var e="\u3000\u3000"+a.trim();if(cutNum>e.len())return e+d;a=~~(e.len()/cutNum)+1;d="";for(var b,f,g;a--;)b=e.realSubstr(0,cutNum).replace(/[\u300c\u201c\u300a\u300e\u2018\uff08]{1,2}$/gm,function(a){e+=a;return""}),e=e.realSubstr(b.len()).replace(/^[\uff0c\u3002\uff1a\u3001\uff1b\uff1a\uff1f\uff01\uff0e\uff09\u300b\u300d\u300f]{1,2}/,
function(a){b+=a;return""}).replace(/^[\u2026\uff5e\uff0d]$/,function(a){b+=a;return""}).replace(/^[a-zA-Z]{1,2}\b/,function(a){return/[a-zA-Z]$/.test(b)?(b+=a,""):a}),f=0<b.replace(tmpRegs[0],"").length,b.len()<cutNum&&f&&(g=tmpRegs[1].test(b)?tmpRegs[1]:tmpRegs[2],b=b.replace(g,"$1 $2").replace(/[\u201c\u2018\u300e\u300c] .*[\u300d\u300f\u2019\u201d]/i,function(a){return a.replace(/([\u201c\u2018\u300e\u300c]) /g,"$1").replace(/ (?=[\u300d\u300f\u2019\u201d])/g,"")+" "}),b.len()<cutNum&&f&&(b=b.replace(/([0-9a-z]) ?/i,
"$1").replace(/ (?=[\u201c\u2018\u300e\u300c])/g,"").replace(/([\u300d\u300f\u2019\u201d]) /g,"$1"))),d+=b+"\n";return d+c}
function doTidy(a){var c=("^[\uff08\u3010\u201c\u300c<]?(?:"+configs.endStrs+")[\uff09\u3011\u201d\u300d>]?$").getReg("gm");a=a.replaceInit().replaceAt(configs.cnQuotes).replace(/\u4f5c\u8005\uff1a.*?\n[\d\/]*[\u53d1\u767c]\u8868[\u4e8e\u65bc]\uff1a.*?\n\u662f\u5426\u9996[\u53d1\u767c]\uff1a.*?\n\u5b57[\u6570\u6578]\uff1a.*?\n/gm,"").convertNumberLetter().replaceSeparator().replace(("^"+configs.Separator+"$").getReg("gm"),function(a){return a.setAlign("","","center")}).replace(c,function(a){return a.setAlign("",
"","center")}).replaceTitle("","\n","center");c=a.split("\n");a="";for(var d=c.length;d--;)a=doSplit(c[d],"\n\n","\n\n")+a;a="\n"+a.replace(/^[ \u3000]+$\n/gm,"").replace(/\n\n{2,}/gm,"\n\n").replaceEnd().replace(/\n\n{3,}/gm,"\n\n\n");if(!$("#Check_AddTop").is(":checked"))return a;c="\u7b80"!==$("#chinese").html()?"\u4f5c\u8005\uff1a{$w}\n{$d}\u53d1\u8868\u4e8e\uff1a{$b}\n\u662f\u5426\u9996\u53d1\uff1a{$y}\n\u5b57\u6570\uff1a{$n} \u5b57\n":"\u4f5c\u8005\uff1a{$w}\n{$d}\u767c\u8868\u65bc\uff1a{$b}\n\u662f\u5426\u9996\u767c\uff1a{$y}\n\u5b57\u6578\uff1a{$n} \u5b57\n";
c=c.fmt({w:$("#inputAuthor").val().trim()||" ",b:$("#inputSite").val().trim()||" ",y:$("#Check_0").is(":checked")?"\u662f":"\u5426",d:(new Date).fmt("yyyy/MM/dd"),n:(a.length-a.findCount(allSpace)).fmt()});return c+"\n"+a}
function editorCleanUp(a){a=a.replaceInit();$("#Check_1").is(":checked")&&(a=a.convertHtmlEntity());$("#Check_2").is(":checked")&&(a=a.convertUnicode());$("#Check_3").is(":checked")&&(a=a.convertVariant());$("#Check_4").is(":checked")&&(a=a.convertSerialNumber());$("#Check_6").is(":checked")&&(a=a.convertNumberLetter());$("#Check_7").is(":checked")&&(a=a.replaceTitle().replaceTitleError());$("#Check_5").is(":checked")&&(a=a.convertPunctuation());$("#Check_8").is(":checked")&&(a=a.replaceSpace());
$("#Check_9").is(":checked")&&(a=a.replaceSeparator());$("#Check_10").is(":checked")&&(a=a.replaceQuotes("fr"));$("#Check_11").is(":checked")&&(a=a.convertEnglish());return a.replaceEnd()}
function setTitle(){var a=/^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$/g,c=$("#inputBookName").val(),d=$("#inputChapter").val(),e="";0<c.length&&(e="\u3010"+c.trim().replace(a,"")+"\u3011");0<d.length&&(e+="\uff08"+d.trim().replace(a,"")+"\uff09");$("#TitleMsg").html(e||$("#TitleMsg").attr("data-tip"))};
