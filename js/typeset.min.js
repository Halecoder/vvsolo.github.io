function doSplit(a,f,c){var d="",g=2*configs.Linenum;if(a.match(/^\u3000{2,}/))return a+"\n\n";a=a.trim();if(0===a.len())return a;var h="",e=a==="\uff0a".times(35)?a:"\u3000\u3000"+a;if(e.len()>g){a=Math.floor(e.len()/g)+1;for(c=0;c<a;c++){var b=e.realSubstring(0,g);b=b.replace(/([\u300c\u201c\u300a\u300e\u2018\uff08]){1,2}$/gm,function(a){e+=a;return""});e=e.realSubstring(b.len());e=e.replace(/^([\uff0c\u3002\uff1a\u3001\uff1b\uff1a\uff1f\uff01\uff0e\uff09\u300b\u300d\u300f]{1,2})/gm,function(a){b+=
a;return""});e=e.replace(/^([\u2026\uff5e\uff0d])$/gm,function(a){b+=a;return""});var k=0===b.replace(/[\w]/g,"").replace(configs.Space,"").replace(configs.HWPunctuation,"").replace(configs.FWPunctuation,"").length;b.len()<g&&!k&&(b=b.match(/([\u4e00-\u9fa0\uff01\uff08\uff09\uff0c\uff0e\uff1a\uff1b\uff1f\u2018\u2019\u201c\u201d\u3002\u300e\u300f\u300c\u300d])([0-9a-zA-Z])/)?b.replace(/([\u4e00-\u9fa0\uff01\uff08\uff09\uff0c\uff0e\uff1a\uff1b\uff1f\u2018\u2019\u201c\u201d\u3002\u300e\u300f\u300c\u300d])([0-9a-zA-Z])/,
"$1 $2"):b.replace(/([0-9a-zA-Z])([\u4e00-\u9fa0\uff01\uff08\uff09\uff0c\uff0e\uff1a\uff1b\uff1f\u2018\u2019\u201c\u201d\u3002\u300e\u300f\u300c\u300d])/,"$1 $2"),b=b.replace(/([\u201c\u2018\u300e\u300c][0-9a-zA-Z ]+[\u300d\u300f\u2019\u201d])/g,function(a){return a.replace(/ /g,"")+" "}));h+=b+"\n"}d+=h+f}else d+=e+c;return d}function cc(a){if(!isNaN(a))return a=a.toLocaleString(),a.replace(/\.00$/,"")}
function doTidy(a){var f=new RegExp("^[ \u3000]*([\uff08\u3010\u201c\u300c<]?)("+configs.endStrs+")([\uff09\u3011\u201d\u300d>]?)$","gm");a=a.replace(/\u4f5c\u8005\uff1a(.*?)\n([\d\/]*)\u53d1\u8868\u4e8e\uff1a(.*?)\n\u662f\u5426\u9996\u53d1\uff1a(.*?)\n\u5b57\u6570\uff1a(.*?)\n/gm,"").replace(/\u4f5c\u8005\uff1a(.*?)\n([\d\/]*)\u767c\u8868\u65bc\uff1a(.*?)\n\u662f\u5426\u9996\u767c\uff1a(.*?)\n\u5b57\u6578\uff1a(.*?)\n/gm,"").replaceInit().replaces([[/\u201c/g,"\u300c"],[/\u201d/g,"\u300d"],[/\u2018/g,
"\u300e"],[/\u2019/g,"\u300f"]]).convertNumberLetter().replaceSeparator();var c=a.split("\n"),d=c.length;a="";for(var g=0;g<d;g++)a+=doSplit(c[g].trim(),"\n","\n\n");a=a.replace(f,function(a){return a.toTitleCenter("","",!0)}).replaceTitle("","",!0).replace(/^([ \u3000]+)$\n/gm,"").replace(/\n{3,}$/gm,"\n\n").replace(/^\n{2,}/gm,"\n");a="\n"+a;f=a.length;c=a.findCount(configs.AllSpace);f={writer:$("#inputAuthor").val().trim(),bbsname:$("#inputSite").val().trim(),dateStr:(new Date).format("yyyy/MM/dd"),
strNum:cc(f-c)};return("zh-CN"==$("html").attr("lang")?"\u4f5c\u8005\uff1a{writer}\n{dateStr}\u53d1\u8868\u4e8e\uff1a{bbsname}\n\u662f\u5426\u9996\u53d1\uff1a\u662f\n\u5b57\u6570\uff1a{strNum} \u5b57\n":"\u4f5c\u8005\uff1a{writer}\n{dateStr}\u767c\u8868\u65bc\uff1a{bbsname}\n\u662f\u5426\u9996\u767c\uff1a\u662f\n\u5b57\u6578\uff1a{strNum} \u5b57\n").format(f)+a}
function editorCleanUp(a){a=a.replaceInit();$("#Check_0").is(":checked")&&(a=a.converHtmlEntity());$("#Check_1").is(":checked")&&(a=a.converUnicode());$("#Check_2").is(":checked")&&(a=a.convertVariant());$("#Check_3").is(":checked")&&(a=a.convertSerialNumber());$("#Check_4").is(":checked")&&(a=a.convertNumberLetter());$("#Check_5").is(":checked")&&(a=a.convertPunctuation());$("#Check_6").is(":checked")&&(a=a.replaceTitle());$("#Check_7").is(":checked")&&(a=a.replaceSpace());$("#Check_8").is(":checked")&&
(a=a.replaceSeparator());$("#Check_9").is(":checked")&&(a=a.replaceQuotes("fr"));$("#Check_10").is(":checked")&&(a=a.convertInitial());return a.replaceEnd()}
function getTitle(a){var f=$("#inputBookName").val(),c=$("#inputChapter").val(),d="";0<f.length&&(d="\u3010"+f.trim().replace(/(^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$)/g,"")+"\u3011",0<c.length&&(d=d+"\uff08"+c.trim().replace(/(^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$)/g,"")+"\uff09"));return 0<d.length?d:a||""};
