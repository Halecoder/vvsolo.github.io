function doSplit(a,c,d){if(0===a.trim().len())return a;if(/^\u3000{2,}/gm.test(a)||a==="\uff0a".times(35))return a+"\n\n";var h=text="",e="\u3000\u3000"+a.trim(),f=f||2*configs.Linenum;if(e.len()>f){d=Math.floor(e.len()/f)+1;for(a=0;a<d;a++){var b=e.realSubstring(0,f);b=b.replace(/([\u300c\u201c\u300a\u300e\u2018\uff08]){1,2}$/gm,function(a){e+=a;return""});e=e.realSubstring(b.len());e=e.replace(/^([\uff0c\u3002\uff1a\u3001\uff1b\uff1a\uff1f\uff01\uff0e\uff09\u300b\u300d\u300f]{1,2})/gm,function(a){b+=
a;return""});e=e.replace(/^([\u2026\uff5e\uff0d])$/gm,function(a){b+=a;return""});var g=0<b.replace("[{$hwPun}{$fwPun}w ]".fmtReg(regCommon),"").length;b.len()<f&&g&&(g="([{$han}{$fwPun}])([0-9a-z])".fmtReg(regCommon,"i"),b=b.match(g)?b.replace(g,"$1 $2"):b.replace("([0-9a-z])([{$han}{$fwPun}])".fmtReg(regCommon,"i"),"$1 $2"),b=b.replace(/([\u201c\u2018\u300e\u300c][0-9a-z ]+[\u300d\u300f\u2019\u201d])/i,function(a){return a.replace(/ /g,"")+" "}));text+=b+"\n"}h+=text+c}else h+=e+d;return h}
function doTidy(a){var c=("^([\uff08\u3010\u201c\u300c<]?)("+configs.endStrs+")([\uff09\u3011\u201d\u300d>]?)$").getReg("gm");a=a.replaceInit().replaces([[/\u201c/g,"\u300c"],[/\u201d/g,"\u300d"],[/\u2018/g,"\u300e"],[/\u2019/g,"\u300f"],[/\u4f5c\u8005\uff1a(.*?)\n([\d\/]*)(\u53d1\u8868\u4e8e|\u767c\u8868\u65bc)\uff1a(.*?)\n\u662f\u5426(\u9996\u53d1|\u9996\u767c)\uff1a(.*?)\n\u5b57[\u6570\u6578]\uff1a(.*?)\n/gm,""]]).convertNumberLetter().replaceSeparator().replace(("^"+configs.Separator+"$").getReg("gm"),
function(a){return a.setAlign("","","center")}).replace(c,function(a){return a.setAlign("","","center")}).replaceTitle("","","center");c=a.split("\n");a="";for(var d=0;d<c.length;d++)a+=doSplit(c[d],"\n","\n\n");a=a.replace(configs.novelAuthor,function(a){return a.trim()}).replace(/^([ \u3000]+)$\n/gm,"").replace(/\n{3,}/gm,"\n\n").replace(configs.novelTitle,function(a){return a.setAlign("","\n","center")}).replace(/\n{4,}/gm,"\n\n\n");c="\u7b80"!==$("#chinese").html()?"\u4f5c\u8005\uff1a{$w}\n{$d}\u53d1\u8868\u4e8e\uff1a{$b}\n\u662f\u5426\u9996\u53d1\uff1a{$y}\n\u5b57\u6570\uff1a{$n} \u5b57\n":
"\u4f5c\u8005\uff1a{$w}\n{$d}\u767c\u8868\u65bc\uff1a{$b}\n\u662f\u5426\u9996\u767c\uff1a{$y}\n\u5b57\u6578\uff1a{$n} \u5b57\n";c=c.fmt({w:$("#inputAuthor").val().trim()||"",b:$("#inputSite").val().trim()||"",y:$("#Check_0").is(":checked")?"\u662f":"\u5426",d:(new Date).fmt("yyyy/MM/dd"),n:(a.length-a.findCount(allSpace)).fmt()});return c+"\n"+a}
function editorCleanUp(a){a=a.replaceInit();$("#Check_1").is(":checked")&&(a=a.converHtmlEntity());$("#Check_2").is(":checked")&&(a=a.converUnicode());$("#Check_3").is(":checked")&&(a=a.convertVariant());$("#Check_4").is(":checked")&&(a=a.convertSerialNumber());$("#Check_6").is(":checked")&&(a=a.convertNumberLetter());$("#Check_7").is(":checked")&&(a=a.replaceTitle());$("#Check_5").is(":checked")&&(a=a.convertPunctuation());$("#Check_8").is(":checked")&&(a=a.replaceSpace());$("#Check_9").is(":checked")&&
(a=a.replaceSeparator());$("#Check_10").is(":checked")&&(a=a.replaceQuotes("fr"));$("#Check_11").is(":checked")&&(a=a.convertInitial());return a.replaceEnd()}
function setTitle(){var a=$("#inputBookName").val(),c=$("#inputChapter").val(),d="";0<a.length&&(d="\u3010"+a.trim().replace(/(^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$)/g,"")+"\u3011");0<c.length&&(d+="\uff08"+c.trim().replace(/(^[\uff08\u3010\u201c\u300c<]|[\uff09\u3011\u201d\u300d>]$)/g,"")+"\uff09");$("#TitleMsg").html(d||$("#TitleMsg").attr("data-tip"))};
