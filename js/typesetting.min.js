Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/g,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.convertEngLine().replaces(configs.rEnd).__endFixed().replace(/\n\n\n+/gm,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__endFixed:function(){var t="」』”’",n="「『“‘";return this.replace(configs.fixLatitude,function(e){return e.cleanSpace().replace(/[“”「」]/g,'"').replace(/[‘’『』]/g,"'").replace(/。/g,".")}).replace(configs.fixLowerExt,function(e){return e.replace(/。/g,".").toLowerCase()}).replace(/^[」』”’]/gm,function(e){return n.charAt(t.indexOf(e))}).replace(/([「『“‘])(?=。|！|？|……|——|~~|$)$/gm,function(e,r){return t.charAt(n.indexOf(r))+e.substring(1)})},replaceSpace:function(){return this.cleanSpace(configs.hanSpace).cleanSpace(configs.engSpace)},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@@{3,}/g,configs.Separator)},replaceQuotes:function(e){var r=this.replaces(configs.rQuotes);return e==="cn"?r.replaceAt(configs.cnQuotes):r},convertEngLine:function(){var t=configs.findEng;return this.replace(t.Line,function(e){if(/^[“「][a-z]{1,6}(?:[。]|[！？]{1,3}|……|——)[」”]$/im.test(e))return e;var r=e.replace(t.LineSkip,"");if(r.length<2)return e;if(!/[,， ]/.test(e))return e;return e.replaces(configs.halfSymbol).matchLower(/[\,， ][A-Z]/g).matchUpper(/[\.\?\!\:\&] ?[a-z]/g).matchUpper(/(?:^| )\b[a-z]\b(?:$| )/g).trim()})},convertEnglish:function(){var r=configs.findEng,n=r.Word,c;return this.matchLower(/[a-zA-Z]/g).matchFirstUpper().matchLower(/[\w][， ][A-Z]/g).matchUpper(r.Continuous).matchLower(r.Latin).replace(r.Quote,function(e){return r.QuoteTest.test(e)?e:e.matchFirstUpper()}).replace(r.Sep,function(e,r,t){return r.matchFirstUpper()+"'"+t.toLowerCase()}).replace(r.Bracket,function(e){return/ /.test(e)?e.matchFirstUpper():e.toUpperCase()}).replace(/\b[\w\-\~～]+\b/g,function(e){return/\d/.test(e)?e.toUpperCase():e}).replace(r.HonorWord,function(e){return e.matchFirstUpper().replace(/。/g,".")}).replace(r.Url,function(e){return e.replace(/。/g,".").toLowerCase()}).replace(/\b[A-Z]\b [A-Z][a-z]/g,function(e){return e.matchLower(/ [A-Z]/)}).matchUpper(("\\b(?:"+r.WordUpper+")\\b").getReg("gi")).replace(("\\b("+n+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(e,r,t){c=("|"+n.toLowerCase()+"|").indexOf("|"+r.toLowerCase()+"|")+1;return("|"+n+"|").substr(c,r.length)+t.toUpperCase()}).matchUpper(/\b[a-z]\b/g)},convertNumberLetter:function(e){return this.replace(/([Ａ-Ｚ][ａ-ｚ]+)(?=[Ａ-Ｚ][ａ-ｚ]+)/g,"$1 ").replaceAt(configs.sNumberLetter)},convertFullNumberLetter:function(e){return this.replaceAt(configs.sNumberLetter,true).replace(configs.regFullNumberTitle,function(e){return e.replaceAt(configs.sNumberLetter)})},convertUnicode:function(){return this.replace(/([＆&]#x|\\u?)[\da-f]{4}[;；]?/gi,function(e){return unescape(e.replace(/[＆&]#x|\\u?/gi,"%u").replace(/[;；]/g,""))}).replace(/[＆&]#(\d+)[;；]/g,function(e,r){return String.fromCharCode(r)}).replace(/([%％][\da-f]{2})+/gi,function(e){try{return decodeURIComponent(e.replace(/％/g,"%"))}catch(e){}return e})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,function(e,r){return configs.sHtmlEntity[r]||configs.sHtmlEntity[r.toLowerCase()]||e})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){var r=configs.sSerialNumber,t=r[1].split("|");return this.replace(("["+r[0]+"]").getReg(),function(e){return"（{$zz}）".fmt(t[r[0].indexOf(e)]||"")})},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.amendSymbols).replaces(configs.nwSymbol)},setAlign:function(e,r,t){var n=configs.Linenum*2,c=this.trims(),i=c.len(),a;e=!checkNull(e)?e:"";r=!checkNull(r)?r:"";if(t==="center"){a=i%4===0?" ":"";if(n>i)c="　".times(~~((n-i)/4))+a+c}else if(t==="right"){a=i%2===0?"":" ";if(n>i)c="　".times(~~((n-i)/2))+a+c}return e+c+r},__Chapter:function(e,r,t,n){var c="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmt(e).chapReg();return this.replace(c,function(e){if(/。/.test(e))return e;return e.replace("[{$b}]".chapReg("g")," ")}).replace(r.chapReg("gim",t),n)},replaceTitle:function(e,r,c,i){var a=!checkNull(e)?e:"\n\n",u=!checkNull(r)?r:"",t=this,n=regChapter,p=configs.regSkipTitle;if(i){n.s=n.sn;n.es=n.e}var o=function(e,r){e=e.replace(/  +/g," ").replace("^[{$sep}]+".chapReg(),"");if(e.length===0)return"";if(/^（?(\d{1,3})）?$/.test(e)){return e.replace(/^（?(\d{1,3})）?$/,function(e){return"（"+e.zeroize(2)+"）"})}e=e.replace(/([^\d\.])[ ·]([上中下]|[一二三四五六七八九十百]{1,5})$/,"$1（$2）").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"，").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(/【?注(\d{1,2})】?/g,"【注$1】").replace(/([^\d\.])(\d{1,2}\/\d{1,2})$/,"$1（$2）").replace(/([^\d\.]) ?\b(\d{1,2})$/,"$1（$2）").replace(/ ?\b([IVXC]{1,6})\b$/i,function(e){return"（"+e.toUpperCase()+"）"});return checkNull(r)?configs.Divide+e:e};var f=function(e,r){return p[r||"t0"].test(e)};t=t.cleanSpace("^{$ts}".chapReg()).__Chapter(n.t0,"^{$f}({$t0})(?:{$s}|$)$","",function(e,r){return r.setAlign(a,u,c)}).__Chapter(n.t1.join("|"),"^{$f}({$t1})({$s}{$e}|{$sn}$)$","|",function(e,r,t){if(f(e)||/^[\!\?！？。]{1,3}$/.test(t)||f(e,"t1"))return e;return(r+o(t)).setAlign(a,u,c)}).__Chapter(n.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(e,r,t,n){if(f(e)||/^[\-\—]{2,4}/.test(r)||!i&&/^[！？。…]{1,3}$/.test(n))return e;if(!t){if(!i&&/[，]|[！？。…’”』」]{1,3}$/.test(n)||f(e,"t2"))return e}if(!"{$n4}[{$c}]".chapReg().test(r))r="第"+r.replace(/(^第+| )/g,"").convertNumberLetter();r=r.replace(/[0-9]+/,function(e){return e.zeroize(2)});if(/^(完|完结|待续)$/m.test(n)){return"【"+r+"·"+n+"】"}return(r+o(n)).setAlign(a,u,c)}).__Chapter(n.t3,"^{$f}{$t3}({$e}|$)$","",function(e,r,t){if(f(e))return e;r=r.convertNumberLetter().zeroize(2);return(r+o(t,"no")).setAlign(a,u,c)});if(c==="center"||c==="break")return t;return t.__Chapter(n.t4,"^{$f}{$t4}{$sn}({$e}|$)$","",function(e,r,t,n){return(a+"第"+t+r+o(n)+u).convertNumberLetter()}).__Chapter(n.t5,"^{$f}{$t5}{$s}({$e}|$)$","",function(e,r,t){return(a+"第"+r+"章"+o(t)+u).convertNumberLetter()}).__Chapter(n.t6,"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(e,r,t){if(f(e)||f(e,"t2")||/^[！？。]{1,3}$/.test(t)||/[。]/.test(e))return e;if(/^[\d０-９]+/.test(r)){if(/[！？。]$/.test(t))return e}else{if(/[！？。…’”』」]$/.test(t))return e}if(e.cleanSpace().eachRegTest(p.t6))return e;r=r.zeroize(2);return(a+"第"+r+"章"+o(t)+u).convertNumberLetter()})},replaceTitleError:function(){var r=function(e){return[["^{$f}第({$zz})[{$c.2}]：".fmt(e).chapReg(),"$1、"],["^{$f}第({$zz})[{$c.2}]$".fmt(e).chapReg(),"$1"],["^{$f}({$zz})[：、。.,]".fmt(e).chapReg(),"$1、"]]};var e="(^{$f}第{$n1}[{$c.2}](?:[：].{0,40}|$)$\\n+|^{$f}{$n1}(?:[：、。\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),t="(^{$f}(第{$n3}[{$c.2}])(?:[：].{0,40}|$)$\\n+|^{$f}{$n3}(?:[：、。\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),n="(\\n+^{$f}（(?:{$n2}|{$n3})）(?:.{0,40}|$)$\\n+){2,}".chapReg(),c="(^{$f}(?:{$n1}|{$n3})(?:[：、。\\.\\,].{0,40}|$)$\\n+)\\1".chapReg("gm"),i="(^{$f}（(?:{$n2}|{$n3})）(?:.{0,40}|$)$\\n+)\\1".chapReg("gm");return this.replace(e,function(e){return e.replaces(r("{$n1}")).replace(/^0{1,4}/gm,"").replace(/\n\n+/gm,"\n")}).replace(t,function(e){return e.replaces(r("{$n3}")).replace(/\n\n+/gm,"\n")}).replace("\\n\\n((?:{$n1}|{$n3})、?)".chapReg(),"$1").replace(n,function(e){return e.replace(/\n\n*/gm,"\n")}).replace(c,function(e,r){return r.replaceTitle("\n\n","")}).replace(i,function(e,r){return r.replaceTitle("\n\n","")})}});