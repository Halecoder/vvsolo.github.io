Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.__amendQuotes().convertEngLine().replaces(configs.rEnd).replace(/\n\n\n+/gm,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__amendQuotes:function(){return this.replace(/^[\u300d\u300f\u201d\u2019]/gm,function(a){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(a))}).replace(/([\u300c\u300e\u201c\u2018])(?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,
function(a,b){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(b))+a.substring(1)})},replaceSpace:function(){return this.cleanSpace(configs.hanSpace).cleanSpace(configs.engSpace)},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@@{3,}/g,configs.Separator)},replaceQuotes:function(a){var b=this.replaces(configs.rQuotes);return"cn"===a?b.replaceAt(configs.cnQuotes):b},convertEngLine:function(){return this.replace(configs.findEngLine,function(a){return/^[\u201c\u300c][a-z]{1,6}(?:[\u3002]|[\uff01\uff1f]{1,3}|\u2026\u2026|\u2014\u2014)[\u300d\u201d]$/mi.test(a)||
2>a.replace(configs.findEngLineSkip,"").length||!/[,\uff0c ]/.test(a)?a:a.replaces(configs.halfSymbol).matchLower(/[,\uff0c ][A-Z]/g).matchUpper(/[\.\?!:&] ?[a-z]/g).trim()})},convertEnglish:function(){var a=configs.pWord,b;return this.matchLower(/[a-zA-Z]/g).matchUpper(/\b[a-z]/g).matchLower(/[\w][\uff0c ][A-Z]/g).matchUpper(/\b[a-z]\b/g).matchUpper(configs.continuouWord).matchLower(configs.findLatin).replace(configs.findEngQuote,function(a){return configs.findEngQuoteTest.test(a)?a:a.matchUpper(/\b[a-z]/g)}).replace(configs.enSepQ,
function(a,b,e){return b.matchUpper(/\b[a-z]/g)+"'"+e.toLowerCase()}).replace(configs.findEngBracket,function(a){return/ /.test(a)?a.matchUpper(/\b[a-z]/gi):a.toUpperCase()}).replace(/\b[\w\-~\uff5e]+\b/g,function(a){return/\d/.test(a)?a.toUpperCase():a}).replace(configs.honorWord,function(a,b){return b.matchUpper(/\b[a-z]/g)+"."}).replace(configs.findUrl,function(a){return a.replace(/\u3002/g,".").toLowerCase()}).replace(/\b[A-Z]\b [A-Z][a-z]/g,function(a){return a.matchLower(/ [A-Z]/)}).matchUpper(("\\b(?:"+
configs.pWordUpper+")\\b").getReg("gi")).replace(("\\b("+a+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(d,g,e){b=("|"+a.toLowerCase()+"|").indexOf("|"+g.toLowerCase()+"|")+1;return("|"+a+"|").substr(b,g.length)+e.toUpperCase()})},convertNumberLetter:function(a){return this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,"$1 ").replaceAt(configs.sNumberLetter)},convertFullNumberLetter:function(a){return this.replaceAt(configs.sNumberLetter,!0).replace(configs.regFullNumberTitle,
function(a){return a.replaceAt(configs.sNumberLetter)})},convertUnicode:function(){return this.replace(/([\uff06&]#x|\\u?)[\da-f]{4}[;\uff1b]?/gi,function(a){return unescape(a.replace(/[\uff06&]#x|\\u?/gi,"%u").replace(/[;\uff1b]/g,""))}).replace(/[\uff06&]#(\d+)[;\uff1b]/g,function(a,b){return String.fromCharCode(b)}).replace(/([%\uff05][\da-f]{2})+/gi,function(a){try{return decodeURIComponent(a.replace(/\uff05/g,"%"))}catch(b){}return a})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,
function(a,b){return configs.sHtmlEntity[b]||configs.sHtmlEntity[b.toLowerCase()]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){var a=configs.sSerialNumber,b=a[1].split("|");return this.replace(("["+a[0]+"]").getReg(),function(d){return"\uff08{$zz}\uff09".fmt(b[a[0].indexOf(d)]||"")})},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.amendSymbols).replaces(configs.nwSymbol)},setAlign:function(a,b,d){var g=
2*configs.Linenum,e=this,f=e.len();d=d||"left";a=null!=a?a:"";b=null!=b?b:"";"center"===d?(d=0===f%4?" ":"",g>f&&(e="\u3000".times(~~((g-f)/4))+d+e)):"right"===d?(d=0===f%2?"":" ",g>f&&(e="\u3000".times(~~((g-f)/2))+d+e)):e=e.space();return a+e+b},__Chapter:function(a,b,d,g){a="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmt(a).chapReg();return this.replace(a,function(a){return/\u3002/.test(a)?a:a.replace("[{$b}]".fmtReg(regChapter,"g")," ")}).replace(b.chapReg("gim",d),
g)},replaceTitle:function(a,b,d,g){var e=a||"\n\n",f=b||"",c=regChapter;g&&(c.s=c.sn,c.es=c.e);var l=function(a,h){if(0===a.length)return"";h=h?!1:!0;a=a.replace(/  +/g," ").replace(("^"+c.s).chapReg(),"").replace(/([^\d\.])[ \u00b7]([\u4e0a\u4e2d\u4e0b]|[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e]{1,5})$/,"$1\uff08$2\uff09").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(("^"+c.s+"$").chapReg(),"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,
"\u3010\u6ce8$1\u3011").replace(/([^\d\.])(\d{1,2}\/\d{1,2})$/,"$1\uff08$2\uff09").replace(/([^\d\.]) ?\b(\d{1,2})$/,"$1\uff08$2\uff09");return 0<a.length&&h?configs.Divide+a:a},n=function(a){return isNaN(a)?a:2>String(a).length?"0"+a:a},k=function(a,h){return configs.regSkipTitle[h||"t0"].test(a)};a=this.cleanSpace("^{$ts}".chapReg()).__Chapter(c.t0,"^{$f}({$t0})(?:{$s}|$)$","",function(a,h){return h.setAlign(e,f,d)}).__Chapter(c.t1.join("|"),"^{$f}({$t1})({$s}{$e}|{$sn}$)$","|",function(a,h,b){return k(a)||
/^[!\?\uff01\uff1f\u3002]{1,3}$/.test(b)||k(a,"t1")?a:(h+l(b)).setAlign(e,f,d)}).__Chapter(c.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(a,b,c,m){if(k(a)||/^[\-\u2014]{2,4}/.test(b)||!g&&/^[\uff01\uff1f\u3002\u2026]{1,3}$/.test(m)||!c&&(!g&&/[\uff0c]|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/.test(m)||k(a,"t2")))return a;"{$n4}[{$c}]".fmtReg(strChapter).test(b)||(b="\u7b2c"+b.replace(/(^\u7b2c+| )/g,"").convertNumberLetter());b=n(b);return/^(\u5b8c|\u5b8c\u7ed3|\u5f85\u7eed)$/m.test(m)?
"\u3010"+b+"\u00b7"+m+"\u3011":(b+l(m)).setAlign(e,f,d)}).__Chapter(c.t3,"^{$f}{$t3}({$e}|$)$","",function(a,b,c){if(k(a))return a;b=n(b.convertNumberLetter());return(b+l(c,"no")).setAlign(e,f,d)});if("center"===d||"break"===d)return a;var p=configs.regSkipTitle.t6;return a.__Chapter(c.t4,"^{$f}{$t4}{$sn}({$e}|$)$","",function(a,b,c,d){return(e+"\u7b2c"+c+b+l(d)+f).convertNumberLetter()}).__Chapter(c.t5,"^{$f}{$t5}{$s}({$e}|$)$","",function(a,b,c){return(e+"\u7b2c"+b+"\u7ae0"+l(c)+f).convertNumberLetter()}).__Chapter(c.t6,
"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(a,b,c){if(k(a)||k(a,"t2")||/^[\uff01\uff1f\u3002]{1,3}$/.test(c)||/[\u3002]/.test(a))return a;if(/^[\d\uff10-\uff19]+/.test(b)){if(/[\uff01\uff1f\u3002]$/.test(c))return a}else if(/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/.test(c))return a;if(a.cleanSpace().eachRegTest(p))return a;b=n(b);return(e+"\u7b2c"+b+"\u7ae0"+l(c)+f).convertNumberLetter()})},replaceTitleError:function(){var a=function(a){return[["^{$f}\u7b2c({$zz})[{$c.2}]\uff1a".fmt(a).chapReg(),
"$1\u3001"],["^{$f}\u7b2c({$zz})[{$c.2}]$".fmt(a).chapReg(),"$1"],["^{$f}({$zz})[\uff1a\u3001\u3002.,]".fmt(a).chapReg(),"$1\u3001"]]},b="(^{$f}\u7b2c{$n1}[{$c.2}](?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n1}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),d="(^{$f}(\u7b2c{$n3}[{$c.2}])(?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n3}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),g="(\\n+^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+){2,}".chapReg(),e="(^{$f}(?:{$n1}|{$n3})(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+)\\1".chapReg("gm"),
f="(^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+)\\1".chapReg("gm");return this.replace(b,function(b){return b.replaces(a("{$n1}")).replace(/^0{1,4}/gm,"").replace(/\n\n+/gm,"\n")}).replace(d,function(b){return b.replaces(a("{$n3}")).replace(/\n\n+/gm,"\n")}).replace("\\n\\n((?:{$n1}|{$n3})\u3001?)".chapReg(),"$1").replace(g,function(a){return a.replace(/\n\n*/gm,"\n")}).replace(e,function(a,b){return b.replaceTitle("\n\n","")}).replace(f,function(a,b){return b.replaceTitle("\n\n","")})}});
