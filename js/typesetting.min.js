Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.__amendQuotes().convertEngLine().replaces(configs.rEnd).replace(/\n\n{2,}/g,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__amendQuotes:function(){return this.replace(/^[\u300d\u300f\u201d\u2019]/gm,function(a){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(a))}).replace(/[\u300c\u300e\u201c\u2018](?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,
function(a){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(a.substring(0,1)))+a.substring(1)})},replaceSpace:function(){return this.replace(configs.hanSpace,"").replace(configs.engSpace,"$1")},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@{4,}/g,configs.Separator)},replaceQuotes:function(a){var b=this.replaces(configs.rQuotes);return"cn"===a?b.replaceAt(configs.cnQuotes):b},convertEngLine:function(){return this.replace(configs.findEngLine,
function(a){return/^[\u201c\u300c][a-z]{1,6}(?:[\u3002]|[\uff01\uff1f]{1,3}|\u2026\u2026|\u2014\u2014)[\u300d\u201d]$/mi.test(a)||2>a.replace(configs.findEngLineSkip,"").length?a:a.replaces(configs.halfSymbol).matchLower(/[,\uff0c ][A-Z]/g).matchUpper(/[\.\?!:&] ?[a-z]/g).trim()})},convertEnglish:function(){var a=configs.pWord;return this.toLowerCase().matchUpper(/\b[a-z]/g).replace(configs.findEngQuote,function(b,a){return configs.findEngQuoteTest.test(b)?b:b.matchUpper(/\b[a-z]/g).matchLower(/[,\uff0c ][A-Z]/g)}).replace(configs.enSepQ,
function(b,a,d){return a.matchUpper(/\b[a-z]/g)+"'"+d.toLowerCase()}).replace(configs.findEngBracket,function(b){return/ /.test(b)?b.matchUpper(/\b[a-z]/g):b.toUpperCase()}).replace(/\b[\w\-~\uff5e]+\b/g,function(b){return/\d/.test(b)?b.toUpperCase():b}).matchUpper(configs.continuouWord).replace(configs.honorWord,function(b,a){return a.matchUpper(/\b[a-z]/g)+"."}).replace(configs.findUrl,function(a){return a.replace(/\u3002/g,".").toLowerCase()}).replace(configs.findLatin,function(a){return a.toLowerCase()}).matchUpper(("\\b(?:"+
configs.pWordUpper+")\\b").getReg("gi")).replace(("\\b("+a+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(b,c,d){b=("|"+a.toLowerCase()+"|").indexOf("|"+c.toLowerCase()+"|")+1;return("|"+a+"|").substr(b,c.length)+d.toUpperCase()})},convertNumberLetter:function(a){return this.convertLetter(a).convertNumber(a)},__convertDBCNumber:function(){return this.replace(/[\uFF10-\uFF19]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})},__convertSBCNumberTitle:function(){return this.replace(configs.regSBCNumberTitle,
function(a){return a.__convertDBCNumber()})},convertNumber:function(a){return 1===a?this.replace(/[\u0030-\u0039]/g,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}).__convertSBCNumberTitle():this.__convertDBCNumber().replaces(configs.nwSymbol)},convertLetter:function(a){var b=this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,"$1 ");return 1===a?b.replace(/[a-z]/gi,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}):b.replace(/[\uff21-\uff3a\uff41-\uff5a]/g,
function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})},convertUnicode:function(){return this.replace(/([\uff06&]#x|\\u?)[\da-f]{4}[;\uff1b]?/gi,function(a){return unescape(a.replace(/[\uff06&]#x|\\u?/g,"%u").replace(/[;\uff1b]/g,""))}).replace(/[\uff06&]#(\d+)[;\uff1b]/g,function(a,b){return String.fromCharCode(b)}).replace(/([%\uff05][\da-f]{2})+/gi,function(a){try{return decodeURIComponent(a.replace(/\uff05/g,"%"))}catch(b){}return a})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,
function(a,b){return configs.sHtmlEntity[b]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){return this.replaceAtSplit(configs.sSerialNumber,"\uff08{$zz}\uff09")},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.amendSymbols).replaces(configs.nwSymbol)},setAlign:function(a,b,c){var d=2*configs.Linenum,e=this.trim(),f=e.len();c=c||"left";a=null!=a?a:"";b=null!=b?b:"";"center"===c?(c=0===f%4?" ":"",d>f&&
(e="\u3000".times(parseInt((d-f)/4,10))+c+e)):"right"===c?(c=0===f%2?"":" ",d>f&&(e="\u3000".times(parseInt((d-f)/2,10))+c+e)):e=e.space();return a+e+b},replaceBorder:function(a){regChapter.t=a;a="^{$f}[{$b.0}]?(?:{$t})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmtReg(regChapter,"gm");var b="[{$b}]".fmtReg(regChapter);return this.replace(a,function(a){return a.replace(b," ")})},__Chapter:function(a,b,c,d){return this.replaceBorder(a).replace(function(a,b){return a.fmtReg(regChapter,"gim",b)}(b.fmt(a),
c),d)},replaceTitle:function(a,b,c,d){var e=a||"\n\n",f=b||"";a=this;b=regChapter;var m=("^"+b.s).getReg();(b.s+"$").getReg();var n=("^"+b.s+"$").getReg();d&&(b.s=b.sn,b.es=b.e);var g=function(a,b){if(0===a.length)return"";b=b?!1:!0;a=a.replace(/  +/g," ").replace(m,"").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(n,"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,"\u3010\u6ce8$1\u3011").replace(/([^\d\.])\b(\d{1,2})$/,"$1\uff08$2\uff09");return 0<a.length&&
b?configs.Divide+a:a},h=function(a,b){return configs.regSkipTitle[b||"t0"].test(a)};a=a.__Chapter(b.t0,"^{$f}({$zz})(?:{$s}|$)$","",function(a,b){return b.setAlign(e,f,c)}).__Chapter(b.t1.join("|"),"^{$f}({$zz})(?:{$sn})({$e}|$)$","|",function(a,b,d){return h(a)||/^[!\?\uff01\uff1f\u3002]{1,3}$/.test(d)||h(a,"t1")?a:(b+g(d)).setAlign(e,f,c)}).__Chapter(b.t2,"^{$f}{$zz}({$sn})({$e}|$)$","",function(a,b,p,k){if(h(a)||/^[\-\u2014]{2,4}/.test(b)||!d&&/^[\uff01\uff1f\u3002\u2026]{1,3}$/.test(k)||!p&&(!d&&
/[\uff0c]|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/.test(k)||h(a,"t2")))return a;"{$n4}[{$c}]".fmtReg(strChapter).test(b)||(b="\u7b2c"+b.replace(/(^\u7b2c+| )/g,"").__convertDBCNumber());return(b+g(k)).setAlign(e,f,c)}).__Chapter(b.t3,"^{$f}{$zz}({$e}|$)$","",function(a,b,d){if(h(a))return a;b=b.__convertDBCNumber();return(b+g(d,"no")).setAlign(e,f,c)});if("center"===c||"break"===c)return a;var l=configs.regSkipTitle.t6;return a.__Chapter(b.t4,"^{$f}{$zz}(?:{$sn})({$e}|$)$","",function(a,
b,c,d){return(e+"\u7b2c"+c+b+g(d)+f).__convertDBCNumber()}).__Chapter(b.t5,"^{$f}{$zz}(?:{$s})({$e}|$)$","",function(a,b,c){return(e+"\u7b2c"+b+"\u7ae0"+g(c)+f).__convertDBCNumber()}).__Chapter(b.t6,"^{$f}{$zz}({$s}|{$s}{$e}|$)$","",function(a,b,c){if(h(a)||/^[\uff01\uff1f\u3002]{1,3}$/.test(c))return a;if(/^[\d\uff10-\uff19]+/.test(b)){if(/[\uff01\uff1f\u3002]$/.test(c))return a}else if(/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/.test(c))return a;for(var d=0;d<l.length;d++)if(l[d].test(a))return a;
return(e+"\u7b2c"+b+"\u7ae0"+g(c)+f).__convertDBCNumber()})},replaceTitleError:function(){var a=this,b=function(a){return a.fmtReg(strChapter,"gm")},c=b("(^[{$space}]*(\u7b2c{$n1}[{$c.2}])(\uff1a.{0,40}|$)$\\n+){2,}");if(c.test(a)){var d=b("^\u7b2c({$n1})[{$c.2}]\uff1a");var e=b("^\u7b2c({$n1})[{$c.2}]$");a=a.replace(c,function(a){return a.replace(d,"$1\u3001").replace(e,"$1").replace(/\n\n+/gm,"\n")}).replace(b("\\n\\n({$n1}\u3001?)"),"$1")}c=b("(^[{$space}]*(\u7b2c{$n3}[{$c.2}])(\uff1a.{0,40}|$)$\\n+){2,}");
c.test(a)&&(d=b("^\u7b2c({$n3})[{$c.2}]\uff1a"),e=b("^\u7b2c({$n3})[{$c.2}]$"),a=a.replace(c,function(a){return a.replace(d,"$1\u3001").replace(e,"$1").replace(/\n\n+/gm,"\n")}).replace(b("\\n\\n({$n3}\u3001?)"),"$1"));return a},replaceTitleErrorBracket:function(){var a=this,b="(\\n+^[{$space}]*\uff08(?:{$n2}|{$n3})\uff09(.{0,40}|$)$\\n+){2,}".fmtReg(strChapter,"gm");b.test(a)&&(a=a.replace(b,function(a){return a.replace(/\n\n*/gm,"\n")}));return a}});
