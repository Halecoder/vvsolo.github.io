Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.__amendQuotes().convertEngLine().replaces(configs.rEnd).replace(/\n\n{2,}/g,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__amendQuotes:function(){return this.replace(/^[\u300d\u300f\u201d\u2019]/gm,function(a){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(a))}).replace(/[\u300c\u300e\u201c\u2018](?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,
function(a){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(a.substring(0,1)))+a.substring(1)})},replaceSpace:function(){return this.replace(configs.hanSpace,"").replace(configs.engSpace,"$1")},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@{4,}/g,configs.Separator)},replaceQuotes:function(a){var b=this.replaces(configs.rQuotes);return"cn"===a?b.replaceAt(configs.cnQuotes):b},convertEngLine:function(){return this.replace(configs.findEngLine,
function(a){return/^[\u201c\u300c][a-z]{1,6}(?:[\u3002]|[\uff01\uff1f]{1,3}|\u2026\u2026|\u2014\u2014)[\u300d\u201d]$/mi.test(a)||2>a.replace(configs.findEngLineSkip,"").length||!/[,\uff0c ]/.test(a)?a:a.replaces(configs.halfSymbol).matchLower(/[,\uff0c ][A-Z]/g).matchUpper(/[\.\?!:&] ?[a-z]/g).trim()})},convertEnglish:function(){var a=configs.pWord;return this.toLowerCase().matchUpper(/\b[a-z]/g).matchLower(/[\w][\uff0c ][A-Z]/g).matchUpper(/\b[a-z]\b/g).matchUpper(configs.continuouWord).replace(configs.findEngQuote,
function(a,c){return configs.findEngQuoteTest.test(a)?a:a.matchUpper(/\b[a-z]/g)}).replace(configs.enSepQ,function(a,c,d){return c.matchUpper(/\b[a-z]/g)+"'"+d.toLowerCase()}).replace(configs.findEngBracket,function(a){return/ /.test(a)?a.matchUpper(/\b[a-z]/g):a.toUpperCase()}).replace(/\b[\w\-~\uff5e]+\b/g,function(a){return/\d/.test(a)?a.toUpperCase():a}).replace(configs.honorWord,function(a,c){return c.matchUpper(/\b[a-z]/g)+"."}).replace(configs.findUrl,function(a){return a.replace(/\u3002/g,
".").toLowerCase()}).replace(configs.findLatin,function(a){return a.toLowerCase()}).matchUpper(("\\b(?:"+configs.pWordUpper+")\\b").getReg("gi")).replace(("\\b("+a+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(b,c,d){b=("|"+a.toLowerCase()+"|").indexOf("|"+c.toLowerCase()+"|")+1;return("|"+a+"|").substr(b,c.length)+d.toUpperCase()})},convertNumberLetter:function(a){return this.convertLetter(a).convertNumber(a)},__convertDBCNumber:function(){return this.replace(/[\uFF10-\uFF19]/g,
function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})},__convertSBCNumberTitle:function(){return this.replace(configs.regSBCNumberTitle,function(a){return a.__convertDBCNumber()})},convertNumber:function(a){return 1===a?this.replace(/[\u0030-\u0039]/g,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}).__convertSBCNumberTitle():this.__convertDBCNumber().replaces(configs.nwSymbol)},convertLetter:function(a){var b=this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,
"$1 ");return 1===a?b.replace(/[a-z]/gi,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}):b.replace(/[\uff21-\uff3a\uff41-\uff5a]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})},convertUnicode:function(){return this.replace(/([\uff06&]#x|\\u?)[\da-f]{4}[;\uff1b]?/gi,function(a){return unescape(a.replace(/[\uff06&]#x|\\u?/g,"%u").replace(/[;\uff1b]/g,""))}).replace(/[\uff06&]#(\d+)[;\uff1b]/g,function(a,b){return String.fromCharCode(b)}).replace(/([%\uff05][\da-f]{2})+/gi,
function(a){try{return decodeURIComponent(a.replace(/\uff05/g,"%"))}catch(b){}return a})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,function(a,b){return configs.sHtmlEntity[b]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){return this.replaceAtSplit(configs.sSerialNumber,"\uff08{$zz}\uff09")},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.amendSymbols).replaces(configs.nwSymbol)},
setAlign:function(a,b,c){var d=2*configs.Linenum,e=this.trim(),g=e.len();c=c||"left";a=null!=a?a:"";b=null!=b?b:"";"center"===c?(c=0===g%4?" ":"",d>g&&(e="\u3000".times(parseInt((d-g)/4,10))+c+e)):"right"===c?(c=0===g%2?"":" ",d>g&&(e="\u3000".times(parseInt((d-g)/2,10))+c+e)):e=e.space();return a+e+b},replaceBorder:function(a){a="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmt(a).chapReg();return this.replace(a,function(a){return/[\u3002]/.test(a)?a:a.replace("[{$b}]".fmtReg(regChapter),
" ")})},__Chapter:function(a,b,c,d){return this.replaceBorder(a).replace(b.chapReg("gim",c),d)},replaceTitle:function(a,b,c,d){var e=a||"\n\n",g=b||"",f=regChapter;d&&(f.s=f.sn,f.es=f.e);var k=function(a,b){if(0===a.length)return"";b=b?!1:!0;a=a.replace(/  +/g," ").replace(("^"+f.s).chapReg(),"").replace(/([^\d\.]) ([\u4e0a\u4e2d\u4e0b])$/,"$1\uff08$2\uff09").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(("^"+f.s+"$").chapReg(),"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,
"\u3010\u6ce8$1\u3011").replace(/([^\d\.])\b(\d{1,2})$/,"$1\uff08$2\uff09");return 0<a.length&&b?configs.Divide+a:a},h=function(a,b){return configs.regSkipTitle[b||"t0"].test(a)};a=this.replace("^{$f}{$ts}".chapReg(),function(a){return a.replace(/ /g,"")}).__Chapter(f.t0,"^{$f}({$t0})(?:{$s}|$)$","",function(a,b){return b.setAlign(e,g,c)}).__Chapter(f.t1.join("|"),"^{$f}({$t1})(?:{$sn})({$e}|$)$","|",function(a,b,d){return h(a)||/^[!\?\uff01\uff1f\u3002]{1,3}$/.test(d)||h(a,"t1")?a:(b+k(d)).setAlign(e,
g,c)}).__Chapter(f.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(a,b,f,l){if(h(a)||/^[\-\u2014]{2,4}/.test(b)||!d&&/^[\uff01\uff1f\u3002\u2026]{1,3}$/.test(l)||!f&&(!d&&/[\uff0c]|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/.test(l)||h(a,"t2")))return a;"{$n4}[{$c}]".fmtReg(strChapter).test(b)||(b="\u7b2c"+b.replace(/(^\u7b2c+| )/g,"").__convertDBCNumber());return(b+k(l)).setAlign(e,g,c)}).__Chapter(f.t3,"^{$f}{$t3}({$e}|$)$","",function(a,b,d){if(h(a))return a;b=b.__convertDBCNumber();
return(b+k(d,"no")).setAlign(e,g,c)});if("center"===c||"break"===c)return a;var m=configs.regSkipTitle.t6;return a.__Chapter(f.t4,"^{$f}{$t4}{$sn}({$e}|$)$","",function(a,b,c,d){return(e+"\u7b2c"+c+b+k(d)+g).__convertDBCNumber()}).__Chapter(f.t5,"^{$f}{$t5}{$s}({$e}|$)$","",function(a,b,c){return(e+"\u7b2c"+b+"\u7ae0"+k(c)+g).__convertDBCNumber()}).__Chapter(f.t6,"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(a,b,c){if(h(a)||h(a,"t2")||/^[\uff01\uff1f\u3002]{1,3}$/.test(c)||/[\u3002]/.test(a))return a;
if(/^[\d\uff10-\uff19]+/.test(b)){if(/[\uff01\uff1f\u3002]$/.test(c))return a}else if(/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/.test(c))return a;for(var d=0;d<m.length;d++)if(m[d].test(a))return a;return(e+"\u7b2c"+b+"\u7ae0"+k(c)+g).__convertDBCNumber()})},replaceTitleError:function(){var a=this,b="(^{$f}\u7b2c{$n1}[{$c.2}](?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n1}(?:[\uff1a\u3001\u3002.,].{0,40}|$)$\\n+){2,}".chapReg();if(b.test(a)){var c="^{$f}\u7b2c({$n1})[{$c.2}]\uff1a".chapReg();var d=
"^{$f}\u7b2c({$n1})[{$c.2}]$".chapReg();var e="^{$f}({$n1})[\uff1a\u3001\u3002.,]".chapReg();a=a.replace(b,function(a){return a.replace(c,"$1\u3001").replace(d,"$1").replace(e,"$1\u3001").replace(/^0{1,4}/gm,"").replace(/\n\n+/gm,"\n")}).replace("\\n\\n({$n1}\u3001?)".chapReg(),"$1")}b="(^{$f}(\u7b2c{$n3}[{$c.2}])(?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n3}(?:[\uff1a\u3001\u3002.,].{0,40}|$)$\\n+){2,}".chapReg();b.test(a)&&(c="^{$f}\u7b2c({$n3})[{$c.2}]\uff1a".chapReg(),d="^{$f}\u7b2c({$n3})[{$c.2}]$".chapReg(),
e="^{$f}({$n3})[\uff1a\u3001\u3002.,]".chapReg(),a=a.replace(b,function(a){return a.replace(c,"$1\u3001").replace(d,"$1").replace(e,"$1").replace(/\n\n+/gm,"\n")}).replace("\\n\\n({$n3}\u3001?)".chapReg(),"$1"));b="(\\n+^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+){2,}".chapReg();b.test(a)&&(a=a.replace(b,function(a){return a.replace(/\n\n*/gm,"\n")}));return a}});
