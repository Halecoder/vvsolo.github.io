Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.__amendQuotes().convertEngLine().replaces(configs.rEnd).replace(/\n\n{2,}/g,"\n\n").replace(/^\n+/,"")},__amendQuotes:function(){return this.replace(/^[\u300d\u300f\u201d\u2019]/gm,function(b){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(b))}).replace(/[\u300c\u300e\u201c\u2018](?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,
function(b){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(b.substring(0,1)))+b.substring(1)})},replaceSpace:function(){return this.replace(configs.hanSpace,"").replace(configs.engSpace,"$1")},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@{4,}/g,configs.Separator)},replaceQuotes:function(b){var a=this.replaces(configs.rQuotes);return"cn"===b?a.replaceAt(configs.cnQuotes):a},convertEngLine:function(){return this.replace(configs.findEngLine,
function(b){return 2>b.replace(configs.findEngLineSkip,"").length?b:b.replaces(configs.halfSymbol).matchLower(/[,\uff0c ][A-Z]/g).matchUpper(/[\.\?!:&] ?[a-z]/g).trim()})},convertEnglish:function(){var b=configs.pWord;return this.toLowerCase().matchUpper(/\b[a-z]/g).matchLower(/[,\uff0c ][A-Z]/g).replace(configs.findEngQuote,function(a,b){return configs.findEngQuoteTest.test(a)?a:a.matchUpper(/\b[a-z]/g).matchLower(/[,\uff0c ][A-Z]/g)}).replace(configs.enSepQ,function(a,b,d){return b.matchUpper(/\b[a-z]/g)+
"'"+d.toLowerCase()}).replace(configs.findEngBracket,function(a){return/ /.test(a)?a.matchUpper(/\b[a-z]/g):a.toUpperCase()}).replace(/\b[\w\-~\uff5e]+\b/g,function(a){return/\d/.test(a)?a.toUpperCase():a}).matchUpper(configs.continuouWord).replace(configs.honorWord,function(a,b){return b.matchUpper(/\b[a-z]/g)+"."}).replace(configs.findUrl,function(a){return a.replace(/\u3002/g,".").toLowerCase()}).replace(configs.findLatin,function(a){return a.toLowerCase()}).matchUpper(("\\b(?:"+configs.pWordUpper+
")\\b").getReg("gi")).replace(("\\b("+b+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(a,c,d){a=("|"+b.toLowerCase()+"|").indexOf("|"+c.toLowerCase()+"|")+1;return("|"+b+"|").substr(a,c.length)+d.toUpperCase()})},convertNumberLetter:function(b){return this.convertLetter(b).convertNumber(b)},__convertDBCNumber:function(){return this.replace(/[\uFF10-\uFF19]/g,function(b){return String.fromCharCode(b.charCodeAt(0)-65248)})},__convertSBCNumberTitle:function(){return this.replace(configs.regSBCNumberTitle,
function(b){return b.__convertDBCNumber()})},convertNumber:function(b){return 1===b?this.replace(/[\u0030-\u0039]/g,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}).__convertSBCNumberTitle():this.__convertDBCNumber().replaces(configs.nwSymbol)},convertLetter:function(b){var a=this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,"$1 ");return 1===b?a.replace(/[a-z]/gi,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}):a.replace(/[\uff21-\uff3a\uff41-\uff5a]/g,
function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})},convertUnicode:function(){return this.replace(/([\uff06&]#x|\\u?)[\da-f]{4}[;\uff1b]?/gi,function(b){return unescape(b.replace(/[\uff06&]#x|\\u?/g,"%u").replace(/[;\uff1b]/g,""))}).replace(/[\uff06&]#(\d+)[;\uff1b]/g,function(b,a){return String.fromCharCode(a)}).replace(/([%\uff05][\da-f]{2})+/gi,function(b){try{return decodeURIComponent(b.replace(/\uff05/g,"%"))}catch(a){}return b})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,
function(b,a){return configs.sHtmlEntity[a]||b})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){return this.replaceAtSplit(configs.sSerialNumber,"\uff08{$zz}\uff09")},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.amendSymbols).replaces(configs.nwSymbol)},setAlign:function(b,a,c){var d=2*configs.Linenum,e=this.trim(),f=e.len();c=c||"left";b=null!=b?b:"";a=null!=a?a:"";"center"===c?(c=0===f%4?" ":"",d>f&&
(e="\u3000".times(parseInt((d-f)/4,10))+c+e)):"right"===c?(c=0===f%2?"":" ",d>f&&(e="\u3000".times(parseInt((d-f)/2,10))+c+e)):e=e.space();return b+e+a},replaceBorder:function(b){regChapter.t=b;b="^{$f}[{$b.0}]?(?:{$t})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmtReg(regChapter,"gm");var a="[{$b}]".fmtReg(regChapter);return this.replace(b,function(b){return b.replace(a," ")})},__Chapter:function(b,a,c,d){return this.replaceBorder(b).replace(function(a,b){return a.fmtReg(regChapter,"gim",b)}(a.fmt(b),
c),d)},replaceTitle:function(b,a,c,d){var e=b||"\n\n",f=a||"";b=this;a=regChapter;var m=("^"+a.s).getReg();(a.s+"$").getReg();var n=("^"+a.s+"$").getReg();d&&(a.s=a.sn,a.es=a.e);var g=function(a,b){if(0===a.length)return"";b=b?!1:!0;a=a.replace(/  +/g," ").replace(m,"").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(n,"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,"\u3010\u6ce8$1\u3011").replace(/([^\d\.])\b(\d{1,2})$/,"$1\uff08$2\uff09");return 0<a.length&&
b?configs.Divide+a:a},h=function(a,b){return configs.regSkipTitle[b||"t0"].test(a)};b=b.__Chapter(a.t0,"^{$f}({$zz})(?:{$s}|$)$","",function(a,b){return b.setAlign(e,f,c)}).__Chapter(a.t1.join("|"),"^{$f}({$zz})(?:{$sn})({$e}|$)$","|",function(a,b,d){return h(a)||/^[!\?\uff01\uff1f\u3002]{1,3}$/.test(d)||h(a,"t1")?a:(b+g(d)).setAlign(e,f,c)}).__Chapter(a.t2,"^{$f}{$zz}({$sn})({$e}|$)$","",function(a,b,p,k){if(h(a)||/^[\-\u2014]{2,4}/.test(b)||!d&&/^[\uff01\uff1f\u3002\u2026]{1,3}$/.test(k)||!p&&(!d&&
/[\uff0c]|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/.test(k)||h(a,"t2")))return a;"{$n4}[{$c}]".fmtReg(strChapter).test(b)||(b="\u7b2c"+b.replace(/(^\u7b2c+| )/g,"").__convertDBCNumber());return(b+g(k)).setAlign(e,f,c)}).__Chapter(a.t3,"^{$f}{$zz}({$e}|$)$","",function(a,b,d){if(h(a))return a;b=b.__convertDBCNumber();return(b+g(d,"no")).setAlign(e,f,c)});if("center"===c||"break"===c)return b;var l=configs.regSkipTitle.t6;return b.__Chapter(a.t4,"^{$f}{$zz}(?:{$sn})({$e}|$)$","",function(a,
b,c,d){return(e+"\u7b2c"+c+b+g(d)+f).__convertDBCNumber()}).__Chapter(a.t5,"^{$f}{$zz}(?:{$s})({$e}|$)$","",function(a,b,c){return(e+"\u7b2c"+b+"\u7ae0"+g(c)+f).__convertDBCNumber()}).__Chapter(a.t6,"^{$f}{$zz}({$s}|{$s}{$e}|$)$","",function(a,b,c){if(h(a)||/^[\uff01\uff1f\u3002]{1,3}$/.test(c))return a;if(/^[\d\uff10-\uff19]+/.test(b)){if(/[\uff01\uff1f\u3002]$/.test(c))return a}else if(/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/.test(c))return a;for(var d=0;d<l.length;d++)if(l[d].test(a))return a;
return(e+"\u7b2c"+b+"\u7ae0"+g(c)+f).__convertDBCNumber()})},replaceTitleError:function(){var b=this,a=function(a){return a.fmtReg(strChapter,"gm")},c=a("(^[{$space}]*(\u7b2c{$n1}[{$c.2}])(\uff1a.{0,40}|$)$\\n+){2,}");if(c.test(b)){var d=a("^\u7b2c({$n1})[{$c.2}]\uff1a");var e=a("^\u7b2c({$n1})[{$c.2}]$");b=b.replace(c,function(a){return a.replace(d,"$1\u3001").replace(e,"$1").replace(/\n\n+/gm,"\n")}).replace(a("\\n\\n({$n1}\u3001?)"),"$1")}c=a("(^[{$space}]*(\u7b2c{$n3}[{$c.2}])(\uff1a.{0,40}|$)$\\n+){2,}");
c.test(b)&&(d=a("^\u7b2c({$n3})[{$c.2}]\uff1a"),e=a("^\u7b2c({$n3})[{$c.2}]$"),b=b.replace(c,function(a){return a.replace(d,"$1\u3001").replace(e,"$1").replace(/\n\n+/gm,"\n")}).replace(a("\\n\\n({$n3}\u3001?)"),"$1"));return b},replaceTitleErrorBracket:function(){var b=this,a="(\\n+^[{$space}]*\uff08(?:{$n2}|{$n3})\uff09(.{0,40}|$)$\\n+){2,}".fmtReg(strChapter,"gm");a.test(b)&&(b=b.replace(a,function(a){return a.replace(/\n\n*/gm,"\n")}));return b}});
