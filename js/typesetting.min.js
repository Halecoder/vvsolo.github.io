Object.extend(String.prototype,{replaceInit:function(){return this.trim().replace(/$/,"\n").replace(/\n\n+/g,"\n")},replaceEnd:function(){return this.convertEngLine().replaces(configs.rEnd).__endFixed().replace(/\n\n\n+/gm,"\n\n").replace(/^\n+/,"").replace(/\n\n+$/,"\n")},__endFixed:function(){return this.replace(configs.fixLatitude,function(a){return a.cleanSpace().replace(/[\u201c\u201d\u300c\u300d]/g,'"').replace(/[\u2018\u2019\u300e\u300f]/g,"'").replace(/\u3002/g,".")}).replace(configs.fixLowerExt,
function(a){return a.replace(/\u3002/g,".").toLowerCase()}).replace(/^[\u300d\u300f\u201d\u2019]/gm,function(a){return"\u300c\u300e\u201c\u2018".charAt("\u300d\u300f\u201d\u2019".indexOf(a))}).replace(/([\u300c\u300e\u201c\u2018])(?=\u3002|\uff01|\uff1f|\u2026\u2026|\u2014\u2014|~~|$)$/gm,function(a,b){return"\u300d\u300f\u201d\u2019".charAt("\u300c\u300e\u201c\u2018".indexOf(b))+a.substring(1)})},replaceSpace:function(){return this.cleanSpace(configs.hanSpace).cleanSpace(configs.engSpace)},replaceSeparator:function(){return this.replaces(configs.rSeparator).replace(/@@{3,}/g,
configs.Separator)},replaceQuotes:function(a){var b=this.replaces(configs.rQuotes);return"cn"===a?b.replaceAt(configs.cnQuotes):b},convertEngLine:function(){var a=configs.findEng;return this.replace(a.Line,function(b){return/^[\u201c\u300c][a-z]{1,6}(?:[\u3002]|[\uff01\uff1f]{1,3}|\u2026\u2026|\u2014\u2014)[\u300d\u201d]$/mi.test(b)||2>b.replace(a.LineSkip,"").length||!/[,\uff0c ]/.test(b)?b:b.replaces(configs.halfSymbol).matchLower(/[,\uff0c ][A-Z]/g).matchUpper(/[\.\?!:&] ?[a-z]/g).matchUpper(/(?:^| )\b[a-z]\b(?:$| )/g).trim()})},
convertEnglish:function(){var a=configs.findEng,b=a.Word,h;return this.matchLower(/[a-zA-Z]/g).matchFirstUpper().matchLower(/[\w][\uff0c ][A-Z]/g).matchUpper(a.Continuous).matchLower(a.Latin).replace(a.Quote,function(c){return a.QuoteTest.test(c)?c:c.matchFirstUpper()}).replace(a.Sep,function(c,f,k){return f.matchFirstUpper()+"'"+k.toLowerCase()}).replace(a.Bracket,function(c){return/ /.test(c)?c.matchFirstUpper():c.toUpperCase()}).replace(/\b[\w\-~\uff5e]+\b/g,function(c){return/\d/.test(c)?c.toUpperCase():
c}).replace(a.HonorWord,function(c){return c.matchFirstUpper().replace(/\u3002/g,".")}).replace(a.Url,function(c){return c.replace(/\u3002/g,".").toLowerCase()}).replace(/\b[A-Z]\b [A-Z][a-z]/g,function(c){return c.matchLower(/ [A-Z]/)}).matchUpper(("\\b(?:"+a.WordUpper+")\\b").getReg("gi")).replace(("\\b("+b+")([0-9]{0,4}|[0-9]{1,4}[a-z]{0,6})\\b").getReg("gi"),function(c,f,k){h=("|"+b.toLowerCase()+"|").indexOf("|"+f.toLowerCase()+"|")+1;return("|"+b+"|").substr(h,f.length)+k.toUpperCase()}).matchUpper(/\b[a-z]\b/g)},
convertNumberLetter:function(a){return this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,"$1 ").replaceAt(configs.sNumberLetter)},convertFullNumberLetter:function(a){return this.replaceAt(configs.sNumberLetter,!0).replace(configs.regFullNumberTitle,function(b){return b.replaceAt(configs.sNumberLetter)})},convertUnicode:function(){return this.replace(/([\uff06&]#x|\\u?)[\da-f]{4}[;\uff1b]?/gi,function(a){return unescape(a.replace(/[\uff06&]#x|\\u?/gi,"%u").replace(/[;\uff1b]/g,
""))}).replace(/[\uff06&]#(\d+)[;\uff1b]/g,function(a,b){return String.fromCharCode(b)}).replace(/([%\uff05][\da-f]{2})+/gi,function(a){try{return decodeURIComponent(a.replace(/\uff05/g,"%"))}catch(b){}return a})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,function(a,b){return configs.sHtmlEntity[b]||configs.sHtmlEntity[b.toLowerCase()]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){var a=configs.sSerialNumber,b=
a[1].split("|");return this.replace(("["+a[0]+"]").getReg(),function(h){return"\uff08{$zz}\uff09".fmt(b[a[0].indexOf(h)]||"")})},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.amendSymbols).replaces(configs.nwSymbol)},setAlign:function(a,b,h){var c=2*configs.Linenum,f=this.trims(),k=f.len();a=checkNull(a)?"":a;b=checkNull(b)?"":b;"center"===h?(h=0===k%4?" ":"",c>k&&(f="\u3000".times(~~((c-k)/4))+h+f)):"right"===h&&(h=0===k%2?"":" ",c>k&&(f="\u3000".times(~~((c-
k)/2))+h+f));return a+f+b},__Chapter:function(a,b,h,c){a="^{$f}[{$b.0}]?(?:{$zz})[{$b.1}]?(?:{$sn})[{$b.0}]?(?:{$e}|$)[{$b.1}]?$".fmt(a).chapReg();return this.replace(a,function(f){return/\u3002/.test(f)?f:f.replace("[{$b}]".chapReg("g")," ")}).replace(b.chapReg("gim",h),c)},replaceTitle:function(a,b,h,c){var f=checkNull(a)?"\n\n":a,k=checkNull(b)?"":b,g=regChapter,p=configs.regSkipTitle;c&&(g.s=g.sn,g.es=g.e);var q=function(d,e){if(0===d.length)return"";e=e?!1:!0;d=d.replace(/  +/g," ").replace(("^"+
g.s).chapReg(),"").replace(/([^\d\.])[ \u00b7]([\u4e0a\u4e2d\u4e0b]|[\u4e00\u4e8c\u4e09\u56db\u4e94\u516d\u4e03\u516b\u4e5d\u5341\u767e]{1,5})$/,"$1\uff08$2\uff09").replace(/ (?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/ (?=[\u4E00-\u9FA5])/g,"").replace(("^"+g.s+"$").chapReg(),"").replace(/\u3010?\u6ce8(\d{1,2})\u3011?/g,"\u3010\u6ce8$1\u3011").replace(/([^\d\.])(\d{1,2}\/\d{1,2})$/,"$1\uff08$2\uff09").replace(/([^\d\.]) ?\b(\d{1,2})$/,"$1\uff08$2\uff09").replace(/ ?\b([IVXC]{1,6})\b$/i,function(l){return"\uff08"+
l.toUpperCase()+"\uff09"});return 0<d.length&&e?configs.Divide+d:d},m=function(d,e){return p[e||"t0"].test(d)};a=this.cleanSpace("^{$ts}".chapReg()).__Chapter(g.t0,"^{$f}({$t0})(?:{$s}|$)$","",function(d,e){return e.setAlign(f,k,h)}).__Chapter(g.t1.join("|"),"^{$f}({$t1})({$s}{$e}|{$sn}$)$","|",function(d,e,l){return m(d)||/^[!\?\uff01\uff1f\u3002]{1,3}$/.test(l)||m(d,"t1")?d:(e+q(l)).setAlign(f,k,h)}).__Chapter(g.t2,"^{$f}{$t2}({$sn})({$e}|$)$","",function(d,e,l,n){if(m(d)||/^[\-\u2014]{2,4}/.test(e)||
!c&&/^[\uff01\uff1f\u3002\u2026]{1,3}$/.test(n)||!l&&(!c&&/[\uff0c]|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/.test(n)||m(d,"t2")))return d;"{$n4}[{$c}]".chapReg().test(e)||(e="\u7b2c"+e.replace(/(^\u7b2c+| )/g,"").convertNumberLetter());e=e.replace(/[0-9]+/,function(r){return r.zeroize(2)});return/^(\u5b8c|\u5b8c\u7ed3|\u5f85\u7eed)$/m.test(n)?"\u3010"+e+"\u00b7"+n+"\u3011":(e+q(n)).setAlign(f,k,h)}).__Chapter(g.t3,"^{$f}{$t3}({$e}|$)$","",function(d,e,l){if(m(d))return d;e=e.convertNumberLetter().zeroize(2);
return(e+q(l,"no")).setAlign(f,k,h)});return"center"===h||"break"===h?a:a.__Chapter(g.t4,"^{$f}{$t4}{$sn}({$e}|$)$","",function(d,e,l,n){return(f+"\u7b2c"+l+e+q(n)+k).convertNumberLetter()}).__Chapter(g.t5,"^{$f}{$t5}{$s}({$e}|$)$","",function(d,e,l){return(f+"\u7b2c"+e+"\u7ae0"+q(l)+k).convertNumberLetter()}).__Chapter(g.t6,"^{$f}{$t6}({$s}|{$s}{$e}|$)$","",function(d,e,l){if(m(d)||m(d,"t2")||/^[\uff01\uff1f\u3002]{1,3}$/.test(l)||/[\u3002]/.test(d))return d;if(/^[\d\uff10-\uff19]+/.test(e)){if(/[\uff01\uff1f\u3002]$/.test(l))return d}else if(/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/.test(l))return d;
if(d.cleanSpace().eachRegTest(p.t6))return d;e=e.zeroize(2);return(f+"\u7b2c"+e+"\u7ae0"+q(l)+k).convertNumberLetter()})},replaceTitleError:function(){var a=function(g){return[["^{$f}\u7b2c({$zz})[{$c.2}]\uff1a".fmt(g).chapReg(),"$1\u3001"],["^{$f}\u7b2c({$zz})[{$c.2}]$".fmt(g).chapReg(),"$1"],["^{$f}({$zz})[\uff1a\u3001\u3002.,]".fmt(g).chapReg(),"$1\u3001"]]},b="(^{$f}\u7b2c{$n1}[{$c.2}](?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n1}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),h="(^{$f}(\u7b2c{$n3}[{$c.2}])(?:[\uff1a].{0,40}|$)$\\n+|^{$f}{$n3}(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+){2,}".chapReg(),
c="(\\n+^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+){2,}".chapReg(),f="(^{$f}(?:{$n1}|{$n3})(?:[\uff1a\u3001\u3002\\.\\,].{0,40}|$)$\\n+)\\1".chapReg("gm"),k="(^{$f}\uff08(?:{$n2}|{$n3})\uff09(?:.{0,40}|$)$\\n+)\\1".chapReg("gm");return this.replace(b,function(g){return g.replaces(a("{$n1}")).replace(/^0{1,4}/gm,"").replace(/\n\n+/gm,"\n")}).replace(h,function(g){return g.replaces(a("{$n3}")).replace(/\n\n+/gm,"\n")}).replace("\\n\\n((?:{$n1}|{$n3})\u3001?)".chapReg(),"$1").replace(c,function(g){return g.replace(/\n\n*/gm,
"\n")}).replace(f,function(g,p){return p.replaceTitle("\n\n","")}).replace(k,function(g,p){return p.replaceTitle("\n\n","")})}});
