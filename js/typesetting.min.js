Object.extend(String.prototype,{replaceInit:function(){return this.space().trim().replace(/$/g,"\n").replace(/\n\n+/gm,"\n").replace("[{$enSep}](?=\b[a-z])".fmtReg(regCommon,"gi"),"'").__amendQuotes()},replaceEnd:function(){return this.__amendQuotes().replace(/\n\n{2,}/gm,"\n\n").replace(/^\n+/g,"")},__amendQuotes:function(){return this.replace(/^\u300d/gm,"\u300c").replace(/^\u300f/gm,"\u300e").replace(/^\u201d/gm,"\u201c").replace(/^\u2019/gm,"\u2018").replace(/\u300c$/gm,"\u300d").replace(/\u300e$/gm,
"\u300f").replace(/\u201c$/gm,"\u201d").replace(/\u2018$/gm,"\u2019")},replaceSpace:function(){var a="[{$han}{$fwPun}]".fmt(regCommon);return this.replace("[\t]+(?=[{$han}])".fmtReg(regCommon),"\n").replace(("[ ]+(?="+a+")").getReg(),"").replace(("("+a+")[ ]+(?=[0-9a-zA-Z])").getReg(),"$1")},replaceSeparator:function(){return this.replace(/\uff0a{35,}/g,"\n!@!@!@!@!\n").replaces(configs.rSeparator).replace(/!@!@!@!@!/g,"\uff0a".times(35)).replace(/@@@@/g,configs.Separator)},replaceQuotes:function(){return this.replaces(configs.rQuotes)},
convertInitial:function(){var a="\\w {$sfwPun}{$shwPun}".fmt(regCommon),b=configs.pWord;return this.toLowerCase().matchUpper(/\b([a-z])/g).replace('[\u300a\u201c\u2018\u300c\u300e\u3010\\"\uff08]([{$zz}]{2,})[\u300b\u201d\u2019\u300d\u3011\u300f\\"\uff09]'.fmtReg(a),function(a,b){return b.match(/^([\uff1f\uff01\u2026\uff5e]+|[\uff1f\uff01\u2026\uff0c,\u3002\d]+)$/,"m")?a:b.match(/([\u2026\uff01\uff1f\u3002!\?\.]$|[\uff0c\uff1a\uff1b\uff06,:;&'])/)?a.replaces(configs.halfSymbol).matchLower(/[, ][A-Z]/g).matchUpper(/[\.\?!:&][ ]?[a-z]/g):
b.match(/[\w\- ]/)?a.matchUpper(/\b([a-z])/g):a}).replace("^([{$zz}]{2,})$".fmtReg(a,"gm"),function(a){return a.matchLower(/[\uff0c ][A-Z]/g)}).replace(/\b([\w\-~\uff5e]+)\b/g,function(a){return a.match(/\d/)?a.toUpperCase():a}).matchUpper("\\b(aa+|bb+|cc+|dd+|ee+|ff+|gg+|hh+|ii+|jj+|kk+|ll+|mm+|nn+|oo+|pp+|qq+|rr+|ss+|tt+|uu+|vv+|ww+|xx+|yy+|zz+)\\b".getReg("gi")).replace("\\b([a-z]+)[{$enSep}]([a-z]+)\\b".fmtReg(regCommon,"gi"),function(a,b,e){return b.matchUpper(/\b[a-z]/g)+"'"+e.toLowerCase()}).replace("\\b({$zz})\u3002(?!$)".fmtReg(configs.honorWord,
"gmi"),function(a,b){return b.matchUpper(/\b[a-z]/g)+"."}).replace(/([0-9a-z]+[\u3002\.])?([\w\u2014\-]+)[\u3002\.](com|net|org|gov)/gi,function(a){return a.replace(/\u3002/g,".").toLowerCase()}).replace(("\\b("+b+")(?:[0-9]*)\\b").getReg("gi"),function(a,d){a=("|"+b.toLowerCase()+"|").indexOf("|"+d.toLowerCase()+"|")+1;return("|"+b+"|").substr(a,d.length)})},convertNumberLetter:function(a){return this.convertLetter(a).convertNumber(a).replaces(configs.nwSymbol)},__convertDBCNumber:function(){return this.replace(/[\uFF10-\uFF19]/g,
function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})},convertNumber:function(a){return 1===a?this.replace(/[\u0030-\u0039]/g,function(a){return String.fromCharCode(a.charCodeAt(0)+65248)}).replace(configs.regSBCNumberTitle.getReg(),function(a){return a.__convertDBCNumber()}):this.__convertDBCNumber()},convertLetter:function(a){var b=this.replace(/([\uff21-\uff3a][\uff41-\uff5a]+)(?=[\uff21-\uff3a][\uff41-\uff5a]+)/g,"$1 ");return 1===a?b.replace(/[a-z]/gi,function(a){return String.fromCharCode(a.charCodeAt(0)+
65248)}):b.replace(/[\uff21-\uff3a\uff41-\uff5a]/g,function(a){return String.fromCharCode(a.charCodeAt(0)-65248)})},convertUnicode:function(){return this.replace(/\\u?([\da-f]{4})/gi,function(a){return unescape(a.replace(/\\u?/gi,"%u"))}).replace(/([\uff06&]#(\d+)[;\uff1b])/gi,function(a){return String.fromCharCode(a.replace(/[\uff06&#;\uff1b]/g,""))}).replace(/([%\uff05][\da-f]{2})+/gi,function(a){try{a=decodeURIComponent(a.replace(/\uff05/g,"%"))}catch(b){}return a})},convertHtmlEntity:function(){return this.replace(configs.regHtmlEntity,
function(a,b){return configs.sHtmlEntity[b]||a})},convertVariant:function(){return this.replaceAt(configs.sVariants)},convertSerialNumber:function(){return this.replaces(configs.sSerialNumber)},convertPunctuation:function(){return this.replaceAt(configs.punSymbol).replaces(configs.amendSymbols).replaces(configs.nwSymbol)},setAlign:function(a,b,c){var d=2*configs.Linenum,e=this.trim(),g=e.len();c=c||"left";a=null!=a?a:"";b=null!=b?b:"";"center"===c?(c=0===g%4?" ":"",d>g&&(e="\u3000".times(parseInt((d-
g)/4,10))+c+e)):"right"===c?(c=0===g%2?"":" ",d>g&&(e="\u3000".times(parseInt((d-g)/2,10))+c+e)):e=e.space();return a+e+b},replaceBorder:function(a){var b=configs.regTitle;b.t=a;b.b=configs.regTitleBorder;a="^{$f}[{$b.0}]?({$t})[{$b.1}]?({$sn})[{$b.0}]?({$e}|$)[{$b.1}]?$".fmtReg(b,"gm");return this.replace(a,function(a){return a.replace(("["+b.b.join("")+"]").getReg()," ")})},replaceTitle:function(a,b,c,d){var e=a||"\n\n",g=b||"";a=this;var f=configs.regTitle,l=("^"+f.s).getReg(),n=("^"+f.s+"$").getReg();
d&&(f.s=f.sn,f.es=f.e);var h=function(a,b){if(0===a.length)return"";b=b?!1:!0;a=a.replace(/[ ]+/g," ").replace(l,"").replace(/[ ](?=[\u4E00-\u9FA5]{2,})/g,"\uff0c").replace(/[ ](?=[\u4E00-\u9FA5])/g,"").replace(n,"");return 0<a.length&&b?configs.Divide+a:a};b=function(a,b){return a.fmtReg(f,"gim",b)};a=a.replaceBorder(f.t0).replace(b("^{$f}({$t0})({$s}|$)$"),function(a,b){return b.setAlign(e,g,c)}).replaceBorder(f.t1.join("|")).replace(b("^{$f}({$t1})(?:{$sn})({$e}|$)$","|"),function(a,b,d){return a.match(/[\u3002]/g)||
d.match(/^[\uff01\uff1f\u3002]{1,3}$/g)||a.match(configs.regSkipTitle.t1)?a:(b+h(d)).setAlign(e,g,c)}).replaceBorder(f.t2).replace(b("^{$f}{$t2}({$sn})({$e}|$)$"),function(a,b,f,k){return a.match(/[\u3002]/g)||b.match(/^[\-\u2014]{2,4}/g)||!d&&k.match(/^[\uff01\uff1f\u3002\u2026]{1,3}$/g)||!f.match(l)&&(!d&&k.match(/[\uff0c]|[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]{1,3}$/g)||a.match(configs.regSkipTitle.t2))?a:("\u7b2c"+b.replace(/(^[\u7b2c]+| )/g,"")+h(k)).setAlign(e,g,c)}).replaceBorder(f.t5).replace(b("^{$f}{$t5}({$e}|$)$"),
function(a,b,d){return a.match(/[\u3002]/g)?a:(b+h(d,"no")).setAlign(e,g,c)});if("center"===c||"break"===c)return a;var m=configs.regSkipTitle.t4;return a.replaceBorder(f.t3).replace(b("^{$f}{$t3}(?:{$sn})({$e}|$)$"),function(a,b,c,d){return e+"\u7b2c"+c+b+h(d)+g}).replaceBorder(f.t6).replace(b("^{$f}{$t6}(?:{$s})({$e}|$)$"),function(a,b,c){return e+"\u7b2c"+b+"\u7ae0"+h(c)+g}).replaceBorder(f.t4).replace(b("^{$f}{$t4}({$s}|{$s}{$e}|$)$"),function(a,b,c){if(a.match(/[\u3002]$/g)||c.match(/^[\uff01\uff1f\u3002]{1,3}$/gm))return a;
if(b.match(/^[\d\uff10-\uff19]+/gm)){if(c.match(/[\uff01\uff1f\u3002]$/g))return a}else if(c.match(/[\uff01\uff1f\u3002\u2026\u2019\u201d\u300f\u300d]$/g))return a;for(var d=0;d<m.length;d++)if(a.match(m[d]))return a;return e+"\u7b2c"+b+"\u7ae0"+h(c)+g})},replaceTitleError:function(){var a=this,b=function(a){return a.fmtReg(regChapterCut,"gm")},c=b("(^[{$space}]*(\u7b2c[0-9]{1,9}[{$c.2}])(\uff1a.{0,40}|$)$\\n+){2,}");if(a.match(c)){var d=b("^\u7b2c([0-9]{1,9})[{$c.2}]\uff1a");var e=b("^\u7b2c([0-9]{1,9})[{$c.2}]$");
a=a.replace(c,function(a){return a.replace(d,"$1\u3001").replace(e,"$1").replace(/\n\n+/gm,"\n")}).replace(/\n\n([0-9]{1,9}\u3001?)/g,"$1")}c=b("(^[{$space}]*(\u7b2c{$n.3}{1,9}[{$c.2}])(\uff1a.{0,40}|$)$\\n+){2,}");a.match(c)&&(d=b("^\u7b2c({$n.3}{1,9})[{$c.2}]\uff1a"),e=b("^\u7b2c({$n.3}{1,9})[{$c.2}]$"),a=a.replace(c,function(a){return a.replace(d,"$1\u3001").replace(e,"$1").replace(/\n\n+/gm,"\n")}).replace(b("\\n\\n({$n.3}{1,9}\u3001?)"),"$1"));return a},replaceTitleErrorBracket:function(){var a=
this,b="(\\n+^[{$space}]*(\uff08{$n.1}{1,9}\uff09)(.{0,40}|$)$\\n+){2,}".fmtReg(regChapterCut,"gm");a.match(b)&&(a=a.replace(b,function(a){return a.replace(/\n\n+/gm,"\n")}));return a}});
