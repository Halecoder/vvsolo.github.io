<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="排版助手（在线版）">
  <meta name="author" content="vsolo">
  <title>排版助手（在线版）</title>
  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.min.css" rel="stylesheet">
  <style>
    html,
    body {
      font-size: 12px;
      min-width: 960px;
    }
    #TextareaEditor {
      margin: 0;
      font-family: Consolas, Menlo, Monaco, Lucida Console, Liberation Mono, DejaVu Sans Mono, Bitstream Vera Sans Mono, Courier New, monospace, serif;
      font-size: 14px;
      line-height: 1.5;
      min-height: 560px;
      width: 100%;
      height: 100%;
    }
    .copy-title {
      cursor: pointer;
      font-weight: normal;
    }
    .editor-title {
      border: 0;
    }
    .editor-message,
    .ace_status-indicator {
      position: fixed;
      right: 10px;
      bottom: 2px;
      z-index: 1001;
      min-width: 300px;
      height: 20px;
      line-height: 20px;
      display: block;
      color: #888;
      font-size: 13px;
      text-align: right;
      padding-right: 10px;
      background-color: none;
    }
    .editor-message {
      bottom: 30px;
      padding: 5px;
    }
    #AlertMsg {
      font-size: 12px;
      font-weight: 400;
    }
    #c-left {
      margin: 0;
      padding: 0;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 0;
      right: 0;
      max-width: 200px;
    }
    #c-right {
      margin: 0;
      padding: 0;
      position: absolute;
      top: 0;
      bottom: 0;
      left: 200px;
      right: 0;
    }
  </style>
</head>
<body>
  <div class="bg-light text-dark" id="c-left">
    <nav class="navbar mb-4">
      <a class="navbar-brand font-weight-bold" href="https://github.com/vvsolo/vvsolo.github.io" title="View on GitHub">排版助手（在线版）</a>
      <ul class="navbar-nav justify-content-end">
        <li class="nav-item active">
          <a class="text-warning" href="./index.zh.html">繁</a>
        </li>
      </ul>
    </nav>
    <div class="container-fluid">
      <div class="input-group mb-2">
        <div class="input-group-prepend">
          <div class="input-group-text">书名</div>
        </div>
        <input type="text" class="form-control" id="inputBookName" placeholder="小说名称">
      </div>
      <div class="input-group mb-2">
        <div class="input-group-prepend">
          <div class="input-group-text">章节</div>
        </div>
        <input type="text" class="form-control" id="inputChapter" placeholder="更新章节">
      </div>
      <div class="input-group mb-2">
        <div class="input-group-prepend">
          <div class="input-group-text">作者</div>
        </div>
        <input type="text" class="form-control" id="inputAuthor" placeholder="作者名称">
      </div>
      <div class="input-group mb-2">
        <div class="input-group-prepend">
          <div class="input-group-text">首发</div>
        </div>
        <input type="text" class="form-control" id="inputSite" placeholder="首发站点">
      </div>
      <hr />
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_0">
          <label class="form-check-label" for="Check_0">修正 HTML 字符实体</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_1">
          <label class="form-check-label" for="Check_1">修正 Unicode</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_2">
          <label class="form-check-label" for="Check_2">修正变体字母</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_3">
          <label class="form-check-label" for="Check_3">修正变体序号</label>
        </div>
      </div>
      <hr />
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_5" checked>
          <label class="form-check-label" for="Check_5">全角标点符号</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_4" checked>
          <label class="form-check-label" for="Check_4">半角字母数字</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_10" checked>
          <label class="form-check-label" for="Check_10">英文首字大写</label>
        </div>
      </div>
      <hr />
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_6" checked>
          <label class="form-check-label" for="Check_6">修正章节标题</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_7" checked>
          <label class="form-check-label" for="Check_7">修正汉字空格</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_8" checked>
          <label class="form-check-label" for="Check_8">修正分隔符号</label>
        </div>
      </div>
      <div class="input-group mb-2">
        <div class="form-check">
          <input class="form-check-input" type="checkbox" id="Check_9" checked>
          <label class="form-check-label" for="Check_9">修正引用符号</label>
        </div>
      </div>
      <hr />
      <div class="input-group mb-2">
        <button type="button" class="btn btn-primary" title="保存设置到 Cookies" id="SaveConfig">保存设置</button>
      </div>
    </div>
  </div>
  <div class="" id="c-right">
    <div class="p-0">
      <div class="alert m-0 rounded-0 border-0 editor-title" role="alert">
        <div class="row">
          <div class="col-7 text-left">
            <h4 class="alert-heading d-inline" id="TitleMsg">此处标题</h4>
            <span class="font-weight-light copy-title" data-clipboard-target="#TitleMsg">点击复制标题到剪贴板</span>
          </div>
          <div class="col-5 text-right">
          </div>
        </div>
        <hr class="bg-light" />
        <div class="row">
          <div class="col-8 text-left">
            <button type="button" class="btn btn-success" title="一键整理" id="onCleanUp">一键整理</button>
            <button type="button" class="btn btn-success" title="排版输出" id="onTypeSet">排版输出</button>
            <button type="button" class="btn btn-secondary copy-content" title="复制文档到剪贴板">复制文档</button>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-outline-secondary font-weight-bold" title="转换简体" id="toSimp">简</button>
              <button type="button" class="btn btn-outline-secondary font-weight-bold" title="转换繁体" id="toTrad">繁</button>
            </div>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-outline-secondary font-weight-bold" title="加粗" data-ubbcode="[b]{s}[/b]">B</button>
              <button type="button" class="btn btn-outline-secondary font-weight-bold" title="下划线" data-ubbcode="[u]{s}[/u]"><u>U</u></button>
              <button type="button" class="btn btn-outline-secondary font-weight-bold" title="斜体" data-ubbcode="[i]{s}[/i]"><em>I</em></button>
            </div>
            <div class="btn-group" role="group">
              <button type="button" class="btn btn-outline-secondary font-weight-bold" title="插入待续" data-insert="（待续）">续</button>
              <button type="button" class="btn btn-outline-secondary font-weight-bold" title="插入全文完" data-insert="（全文完）">完</button>
            </div>
          </div>
          <div class="col-4 text-right">
            <button type="button" class="btn btn-primary" title="保存临时文档" id="SaveEditor">保存</button>
            <button type="button" class="btn btn-info" title="还原临时文档" id="RestoreEditor">还原</button>
            <button type="button" class="btn btn-danger" title="清空文档" id="ClearEditor">清空</button>
          </div>
        </div>
      </div>
      <pre id="TextareaEditor" placeholder="粘贴文本到此处"></pre>
      <div class="editor-status" id="statusBar"></div>
      <div class="editor-message">
        <span class="badge badge-warning" id="AlertMsg">填写作者等相关信息后，“一键整理” → “排版输出”.</span>
      </div>
    </div>
    <!-- /.container -->

<!-- Bootstrap core JavaScript -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.slim.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.1/clipboard.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.1/ace.js"></script>

<script src="js/config.js?201810"></script>
<script src="js/extend.js?201810"></script>
<script src="js/typesetting.min.js?201810"></script>
<script src="js/typeset.min.js?201810"></script>
<script src="js/conver.dic.js?201810"></script>

<script src="./ace/theme-novel.js"></script>
<script src="./ace/mode-novel.js"></script>
<script src="./ace/ext-statusbar.js"></script>
<script>
  //sEditor.setMode("ace/mode/novel");
  $(function() {
    // 编辑区域全屏占，修正编辑器高度
    var tEditor = $('#TextareaEditor')
    var editorTitleHeight = $('.editor-title').outerHeight()
    var editorStatusHeight = $('.editor-status').outerHeight()
    tEditor.height(parseInt($(this).outerHeight() - editorTitleHeight - editorStatusHeight))
    // 初始化编辑器
    var editor = ace.edit("TextareaEditor");
    editor.setOptions({
      theme: "ace/theme/novel",
      mode: "ace/mode/novel",
      // 折行
      wrap: 'free',
      indentedSoftWrap: false,
      // 字体
      fontSize: 14,
      // 打印线
      printMarginColumn: 70,
      // 显示空格
      showInvisibles: true,
      // 显示滚动条
      //vScrollBarAlwaysVisible: true,
      // 空字符是否可复制
      copyWithEmptySelection: true,
      // 行号固定宽度
      fixedWidthGutter: true
    });
    var StatusBar = ace.require("ace/ext/statusbar").StatusBar;
    // create a simple selection status indicator
    var statusBar = new StatusBar(editor, document.getElementById("statusBar"));
    var sEditor = editor.getSession()

    // 读取保存的设置
    $('#inputBookName').val($.cookie('inputBookName') || '')
    $('#inputChapter').val($.cookie('inputChapter') || '')
    $('#TitleMsg').html(getTitle('此处标题'))
    $('#inputAuthor').val($.cookie('inputAuthor') || '')
    $('#inputSite').val($.cookie('inputSite') || '')
    for (var i = 0; i < 4; i++) {
      var tmp = 'Check_' + i;
      if ($.cookie(tmp)) {
        $('#' + tmp).removeAttr('checked').attr('checked', 'checked')
      } else {
        $('#' + tmp).removeAttr('checked')
      }
    }
    // 保存设置
    $('#SaveConfig').click(function() {
      $.cookie('inputBookName', $('#inputBookName').val(), { expires: 365 })
      $.cookie('inputChapter', $('#inputChapter').val(), { expires: 365 })
      $.cookie('inputAuthor', $('#inputAuthor').val(), { expires: 365 })
      $.cookie('inputSite', $('#inputSite').val(), { expires: 365 })
      for (var i = 0; i < 4; i++) {
        var tmp = 'Check_' + i;
        if ($('#' + tmp).is(':checked'))
          $.cookie(tmp, 'checked', {})
        else
          $.removeCookie(tmp)
      }
      $('#AlertMsg').html('设置已保存！')
    })
    // 转简体
    $('#toSimp').on('click', function() {
      var sVal = sEditor.getValue()
      sVal = Othered(Simplized(sVal))
      sEditor.setValue(sVal).focus()
    })
    // 转繁体
    $('#toTrad').on('click', function() {
      var sVal = sEditor.getValue()
      sVal = Traditionalized(sVal)
      sEditor.setValue(sVal).focus()
    })
    // 实时显示文章标题
    $('#inputBookName,#inputChapter').on('keyup keydown change focus input propertychange', function() {
      $('#TitleMsg').html(getTitle('此处标题'))
    })
    // 清空文档
    $('#ClearEditor').click(function() {
      sEditor.setValue('').focus()
    });
    // 保存文档
    $('#SaveEditor').click(function() {
      var sVal = sEditor.getValue()
      if (sVal.length > 0) {
        $('#AlertMsg').data('doc', sVal).html('文档已保存！')
      }
      editor.focus()
    });
    // 还原文档
    $('#RestoreEditor').click(function() {
      var sVal = $('#AlertMsg').data('doc')
      if (sVal.length > 0) {
        sEditor.setValue(sVal).focus()
        $('#AlertMsg').html('文档已还原！')
      }
    });
    // 一键整理
    $('#onCleanUp').click(function() {
      var sVal = sEditor.getValue()
      if (sVal.length > 0) {
        sVal = editorCleanUp(sVal)
        sEditor.setValue(sVal).focus()
      }
    })
    // 一键排版
    $('#onTypeSet').click(function() {
      var sVal = sEditor.getValue()
      if (sVal.length > 0) {
        $('#AlertMsg').data('doc', sVal).html('排版成功！重排请点击“还原”按钮！')
        sEditor.setValue(doTidy(sVal)).focus()
      }
    })
    // 简单UBB
    $('.btn[data-ubbcode]').each(function() {
      var $this = $(this)
      $this.click(function() {
        var selection = sEditor.getTextRange(editor.getSelectionRange())
        if (selection.length > 0) {
          var tmp = $this.data('ubbcode').replace(/\{s\}/g, selection)
          editor.insert(tmp)
        } else {
          $('#AlertMsg').html('未选中文字！')
        }
      })
    })
    // 插入待续完结
    $('.btn[data-insert]').each(function() {
      var tmp = $(this).data('insert')
      $(this).click(function() {
        editor.insert(tmp)
      })
    })
    // 复制标题到剪贴板
    var clipboardTitle = new ClipboardJS('.copy-title')
    clipboardTitle.on('success', function(e) {
      $('#AlertMsg').html('标题复制成功！')
      e.clearSelection()
    });
    // 复制文档到剪贴板
    var clipboardText = new ClipboardJS('.copy-content', {
      text: function(trigger) {
        return editor.getValue();
      }
    })
    clipboardText.on('success', function(e) {
      $('#AlertMsg').html('文档复制成功！')
      e.clearSelection()
    });
  });
</script>
<script>
var _hmt = _hmt || [];
(function() {
var hm = document.createElement("script");
hm.src = "https://hm.baidu.com/hm.js?4e383017601b1ea13cab1d5efbae8584";
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(hm, s);
})();
</script>
</body>
</html>