<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="排版助手（在线版）">
  <meta name="author" content="vsolo">
  <title>排版助手（在线版）</title>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <style>
    html,
    body {
      font-size: 12px;
      background-color: #fafafa;
    }
    #copyTitle {
      cursor: pointer;
      font-weight: normal;
    }
  </style>
</head>

<body>
  <nav class="navbar navbar-dark bg-dark">
    <a class="navbar-brand" href="#">排版助手（在线版）</a>
    <ul class="navbar-nav justify-content-end">
      <li class="nav-item active">
        <a class="nav-link" href="./index.zh.html">訪問繁體版</a>
      </li>
    </ul>
  </nav>
  <div class="container-fluid" style="margin:20px 0;">
    <div class="row">
      <div class="col-2">

        <div class="container-fluid">
          <div class="alert alert-primary" role="alert">
            <strong>标头设置</strong>
          </div>
          <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">书名</div>
            </div>
            <input type="text" class="form-control" id="inputBookName" placeholder="小说名称">
          </div>
          <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">章节</div>
            </div>
            <input type="text" class="form-control" id="inputChapter" placeholder="更新章节">
          </div>
          <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">作者</div>
            </div>
            <input type="text" class="form-control" id="inputAuthor" placeholder="作者名称">
          </div>
          <div class="input-group mb-2">
            <div class="input-group-prepend">
              <div class="input-group-text">首发</div>
            </div>
            <input type="text" class="form-control" id="inputSite" placeholder="首发站点">
          </div>
          <div class="alert alert-primary" role="alert">
            <strong>格式设置</strong>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_0">
              <label class="form-check-label" for="Check_0">修正 HTML 字符实体</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_1">
              <label class="form-check-label" for="Check_1">修正 Unicode</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_2">
              <label class="form-check-label" for="Check_2">修正变体字母</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_3">
              <label class="form-check-label" for="Check_3">修正变体序号</label>
            </div>
          </div>
          <hr />
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_5" checked>
              <label class="form-check-label" for="Check_5">全角标点符号</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_4" checked>
              <label class="form-check-label" for="Check_4">半角字母数字</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_10" checked>
              <label class="form-check-label" for="Check_10">英文首字大写</label>
            </div>
          </div>
          <hr />
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_6" checked>
              <label class="form-check-label" for="Check_6">修正章节标题</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_7" checked>
              <label class="form-check-label" for="Check_7">修正汉字空格</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_8" checked>
              <label class="form-check-label" for="Check_8">修正分隔符号</label>
            </div>
          </div>
          <div class="input-group mb-2">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="Check_9" checked>
              <label class="form-check-label" for="Check_9">修正引用符号</label>
            </div>
          </div>
          <hr />
          <div class="input-group mb-2">
            <button type="button" class="btn btn-primary" title="保存设置到 Cookies" id="SaveConfig">保存设置</button>
          </div>
        </div>
      </div>
      <div class="col-10">
        <div class="container-fluid" style="padding-bottom:40px">
          <div class="alert alert-warning" role="alert">
            <h5 class="alert-heading">
              <span id="TitleMsg">此处标题</span>
              <span title="复制标题到剪贴板" class="badge badge-secondary" id="copyTitle">复制</span>
            </h5>
            <input type="text" style="position: absolute; left: -1000px;" id="TitleContent" value="">
            <hr />
            <span id="AlertMsg" data-doc="">填写作者等相关信息后，“一键整理” → “排版输出”.</span>
            <span class="float-right"><strong id="CountMsg">0</strong> 字节</span>
          </div>
          <div>
            <div class="float-left">
              <button type="button" class="btn btn-success" title="一键整理" id="onCleanUp">一键整理</button>
              <button type="button" class="btn btn-success" title="排版输出" id="onTypeSet">排版输出</button>
              <button type="button" class="btn btn-secondary" title="复制文档到剪贴板" id="onCopy">复制文档</button>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary" title="转换简体" id="toSimp"><strong>简</strong></button>
                <button type="button" class="btn btn-outline-secondary" title="转换繁体" id="toTrad"><strong>繁</strong></button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary" title="加粗" data-ubbcode="[b]{s}[/b]"><strong>B</strong></button>
                <button type="button" class="btn btn-outline-secondary" title="下划线" data-ubbcode="[u]{s}[/u]"><strong><u>U</u></strong></button>
                <button type="button" class="btn btn-outline-secondary" title="斜体" data-ubbcode="[i]{s}[/i]"><strong><em>I</em></strong></button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary" title="插入待续" data-insert="（待续）"><strong>续</strong></button>
                <button type="button" class="btn btn-outline-secondary" title="插入全文完" data-insert="（全文完）"><strong>完</strong></button>
              </div>
              <div class="btn-group" role="group">
                <button type="button" class="btn btn-outline-secondary" title="显隐辅助线" data-subline><strong>辅</strong></button>
              </div>
            </div>
            <div class="float-right">
              <button type="button" class="btn btn-primary" title="临时保存文档" id="SaveEditor">保存</button>
              <button type="button" class="btn btn-info" title="还原临时文档" id="RestoreEditor">还原</button>
              <button type="button" class="btn btn-danger" title="清空文档" id="ClearEditor">清空</button>
            </div>
          </div>
        </div>
        <div class="container-fluid">
          <textarea class="form-control" id="TextareaEditor" style="min-height:480px;background-color: #f2f2f2;font-family: '新宋体', '宋体';font-size: 14px;font-weight: bold;" placeholder="粘贴文本到此处" data-lang=""></textarea>
        </div>
        <div id="subline" style="position: absolute;left: 538px;width:0px;border-right:2px dashed #B8DAFF;height:478px;">
        </div>
    </div>
  </div>
  <!-- /.container -->

  <!-- Bootstrap core JavaScript -->
  <script src="https://cdn.bootcss.com/jquery/3.2.1/jquery.slim.min.js"></script>
  <script src="https://cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script src="js/jquery.shortcuts.js"></script>

  <script src="js/config.js"></script>
  <script src="js/typesetting.min.js"></script>
  <script src="js/typeset.js"></script>
  <script src="js/conver.dic.js"></script>
  <script>
    $(function() {
	  
      // 读取保存的设置
      $('#inputBookName').val($.cookie('inputBookName') || '')
      $('#inputChapter').val($.cookie('inputChapter') || '')
      $('#TitleMsg').html(getTitle('此处标题'))
      $('#inputAuthor').val($.cookie('inputAuthor') || '')
      $('#inputSite').val($.cookie('inputSite') || '')
      for (var i = 0; i < 4; i++) {
        var tmp = 'Check_' + i;
        if ($.cookie(tmp)) {
          $('#' + tmp).removeAttr('checked').attr('checked', 'checked')
        } else {
          $('#' + tmp).removeAttr('checked')
        }
      }
      // 保存设置
      $('#SaveConfig').click(function() {
        $.cookie('inputBookName', $('#inputBookName').val(), { expires: 365 })
        $.cookie('inputChapter', $('#inputChapter').val(), { expires: 365 })
        $.cookie('inputAuthor', $('#inputAuthor').val(), { expires: 365 })
        $.cookie('inputSite', $('#inputSite').val(), { expires: 365 })
        for (var i = 0; i < 4; i++) {
          var tmp = 'Check_' + i;
          if ($('#' + tmp).is(':checked'))
            $.cookie(tmp, 'checked', { expires: 365 })
          else {
            $.removeCookie(tmp)
          }
        }
        $('#AlertMsg').html('设置已保存！')
      })
      // 按钮
      var tEditor = $('#TextareaEditor')
      tEditor.focus()
      // 辅助线
      var position = tEditor.position()
      $('#subline').offset({ top: position.top + 63 })
      $('[data-subline]').click(function() {
        $('#subline').toggle()
      })
      // 转简体
      $('#toSimp').click(function() {
        tEditor.val(Othered(Simplized(tEditor.val())))
      })
      // 转繁体
      $('#toTrad').click(function() {
        tEditor.val(Traditionalized(tEditor.val()))
      })
      // 实时统计字符
      tEditor.on('keyup keydown change focus', function() {
        $('#CountMsg').html(tEditor.val().length)
      })
      // 实时显示文章标题
      $('#inputBookName,#inputChapter').on('keyup keydown change focus', function() {
        $('#TitleMsg').html(getTitle('此处标题'))
      })
      // 清空文档
      $('#ClearEditor').click(function() {
        tEditor.val('').focus()
      });
      // 保存文档
      $('#SaveEditor').click(function() {
        var sEditor = tEditor.val()
        if (sEditor.length > 0) {
          $('#AlertMsg').data('doc', sEditor)
          $('#AlertMsg').html('文档已保存！')
        }
        tEditor.focus()
      });
      // 还原文档
      $('#RestoreEditor').click(function() {
        var sEditor = $('#AlertMsg').data('doc')
        if (sEditor.length > 0) {
          tEditor.val(sEditor)
          $('#AlertMsg').html('文档已还原！')
        }
        tEditor.focus()
      });
      // 一键整理
      $('#onCleanUp').click(function() {
        var sVal = tEditor.val()
        if (sVal.length > 0) {
          tEditor.val(getCleanUp(sVal))
          tEditor.focus()
        }
      })
      // 一键排版
      $('#onTypeSet').click(function() {
        var sVal = tEditor.val()
        if (sVal.length > 0) {
          $('#AlertMsg').data('doc', sVal)
          $('#AlertMsg').html('排版成功！原格式文档已保存，若想重排请点击“还原”按钮！')
          tEditor.val(doTidy(sVal))
          tEditor.focus()
        }
      })
      // 简单UBB
      $('.btn[data-ubbcode]').each(function() {
        var $this = $(this)
        $this.click(function() {
          if (tEditor.selectionRange().length > 0) {
            var tmp = $this.data('ubbcode').replace(/\{s\}/g, tEditor.selectionRange())
            tEditor.insertContent(tmp)
            $('#AlertMsg').html('标题已' + $this.attr('title') + '！')
          } else {
            $('#AlertMsg').html('未选中文字！')
          }
        })
      })
      // 插入待续完结
      $('.btn[data-insert]').each(function() {
        var $this = $(this)
        $this.click(function() {
          var tmp = $this.data('insert')
          tEditor.insertContent(tmp)
        })
      })
      // 复制标题到剪贴板
      $('#copyTitle').click(function() {
        var sVal = $('#TitleMsg').text()
        if (sVal.length > 0) {
          $('#TitleContent').val(sVal)
          $('#TitleContent').select()
          document.execCommand('Copy')
          $('#AlertMsg').html('标题已复制到剪贴板！')
        }
      })
      // 复制文章到剪贴板
      $('#onCopy').click(function() {
        var sVal = tEditor.val()
        if (sVal.length > 0) {
          tEditor.focus().select()
          document.execCommand('Copy')
          tEditor.blur()
          $('#AlertMsg').html('文档已复制到剪贴板！')
        }
      });
    });
  </script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?4e383017601b1ea13cab1d5efbae8584";
  var s = document.getElementsByTagName("script")[0];
  s.parentNode.insertBefore(hm, s);
})();
</script>
</body>

</html>